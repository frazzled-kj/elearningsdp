<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Anxiety & Trauma Module</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fb;
      color: #222;
    }
    header {
      background: #1f3c88;
      color: white;
      padding: 1rem 1.5rem;
    }
    header h1 {
      margin: 0;
      font-size: 1.3rem;
    }
    main {
      max-width: 900px;
      margin: 1.5rem auto 2.5rem;
      padding: 0 1rem;
    }
    .card.screen {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      padding: 1.5rem 1.75rem;
      margin-bottom: 1.5rem;
    }
    h2 {
      margin-top: 0;
    }
    p {
      line-height: 1.5;
    }
    .hidden {
      display: none;
    }
    #cueOverlay:not(.hidden) {
      display: flex;
    }
    .question {
      margin: 1rem 0 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #e0e3ec;
    }
    .question:last-child {
      border-bottom: none;
    }
    .options label {
      display: block;
      margin: 0.25rem 0;
    }
    .options input[type="radio"] {
      margin-right: 0.4rem;
    }
    .nav-buttons {
      margin-top: 1rem;
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    button {
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      background: #1f3c88;
      color: white;
      cursor: pointer;
      font-size: 0.95rem;
    }
    button.secondary {
      background: #e0e3ec;
      color: #222;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
    }
    .error {
      color: #b3261e;
      margin-top: 0.5rem;
      font-size: 0.9rem;
    }
    .feedback {
      margin-top: 0.75rem;
      font-size: 0.95rem;
      color: #155724;
    }
    .info-box {
      background: #f0f3ff;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin: 0.75rem 0 1rem;
      font-size: 0.95rem;
    }
    .cue-table-wrapper {
      overflow-x: auto;
      margin: 0.75rem 0 1.25rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.9rem;
    }
    th, td {
      border: 1px solid #d2d6e3;
      padding: 0.4rem 0.5rem;
      vertical-align: top;
    }
    th {
      background: #ebeffa;
      font-weight: 600;
    }
    .highlight {
      background: #fff4c2;
    }
    .inline-note {
      display: inline-block;
      padding: 0.1rem 0.35rem;
      margin-left: 0.25rem;
      background: #e7f3ff;
      border-radius: 4px;
      font-size: 0.8rem;
      color: #1f3c88;
    }
    textarea {
      width: 100%;
      min-height: 80px;
      padding: 0.5rem;
      border-radius: 6px;
      border: 1px solid #cdd1de;
      font-family: inherit;
      font-size: 0.95rem;
      resize: vertical;
    }
    .expert-box {
      background: #f4faf5;
      border-left: 4px solid #2e7d32;
      padding: 0.75rem 1rem;
      margin-top: 0.75rem;
      font-size: 0.95rem;
    }
    .view-table-inline {
      text-align: right;
      margin: 0.25rem 0 0.5rem;
    }
    .small-label {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 0.25rem;
    }
  </style>
</head>
<body>
<header>
  <h1>Anxiety & Trauma: Case-Based Learning</h1>
</header>
<main>

  <!-- START SCREEN -->
  <div id="startScreen" class="card screen">
    <h2>Welcome</h2>
    <p>
      This short online module will walk you through anxiety and trauma-related disorders
      using realistic case vignettes. You will:
    </p>
    <ul>
      <li>Take a brief case-based quiz</li>
      <li>Work through a short lesson with examples and practice</li>
      <li>Finish with another case-based quiz</li>
    </ul>
    <p>The whole experience should take about 10–15 minutes.</p>
    <div class="nav-buttons">
      <button id="startBtn">Start</button>
    </div>
  </div>

  <!-- PRE-TEST -->
  <div id="pretestScreen" class="card screen hidden">
    <h2>Case Quiz: Before the Lesson</h2>
    <p>For each scenario, choose the diagnosis that best fits the description.</p>

    <div class="question">
      <p><strong>Pre Q1.</strong> Neha has spent the last seven months feeling tense and “on edge” most days. She worries about grades, her younger brother’s health, money, and even small day-to-day decisions. The worry is hard to shut off and comes with muscle tension and trouble sleeping. There has been no single major trauma, but the constant worry interferes with her ability to focus in class.</p>
      <div class="options">
        <label><input type="radio" name="pre_q1" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q1" value="SAD"> Social Anxiety Disorder</label>
        <label><input type="radio" name="pre_q1" value="Adjustment"> Adjustment Disorder with anxiety</label>
        <label><input type="radio" name="pre_q1" value="OCD"> Obsessive-Compulsive Disorder</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q2.</strong> Omar sometimes feels generally stressed about school, but his biggest concern is sudden episodes that begin without warning while he is on the bus or in the cafeteria. Within minutes, his heart pounds, he feels short of breath, his hands tingle, and he fears he might lose control or die. In between episodes he worries a lot about when the next one will happen and avoids crowded places.</p>
      <div class="options">
        <label><input type="radio" name="pre_q2" value="SpecificPhobia"> Specific Phobia (public transportation)</label>
        <label><input type="radio" name="pre_q2" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q2" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q2" value="SAD"> Social Anxiety Disorder</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q3.</strong> A few months after witnessing a shooting outside her apartment, Lila still has frequent nightmares about the event and sometimes feels like it is happening again when she hears loud bangs. She avoids walking near the location of the shooting, feels less interested in hanging out with friends, and startles easily at sudden noises. These symptoms have been present for over three months and have made it hard for her to keep up with schoolwork.</p>
      <div class="options">
        <label><input type="radio" name="pre_q3" value="AcuteStress"> Acute Stress Disorder</label>
        <label><input type="radio" name="pre_q3" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q3" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q3" value="Adjustment"> Adjustment Disorder with mixed anxiety and depressed mood</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q4.</strong> During the last two months, Evan has experienced several sudden episodes where he feels an intense surge of fear, his heart races, he feels dizzy, and he worries he might collapse. The episodes reach a peak within a few minutes and then gradually fade. Some occur while he is simply watching TV at home. In between episodes, Evan worries constantly about having another one and has started avoiding long lines at the grocery store.</p>
      <div class="options">
        <label><input type="radio" name="pre_q4" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q4" value="SpecificPhobia"> Specific Phobia (crowds)</label>
        <label><input type="radio" name="pre_q4" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q4" value="GAD"> Generalized Anxiety Disorder</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q5.</strong> For the past eight months, Priya has worried almost every day about grades, friendships, the safety of her parents when they commute, and even minor scheduling issues. Her worry feels excessive compared with what is actually happening, and she finds it hard to control once it starts. She has trouble falling asleep and feels fatigued. There has been no single traumatic event, but the worry has made it harder to enjoy time with friends and stay organized with school responsibilities.</p>
      <div class="options">
        <label><input type="radio" name="pre_q5" value="Adjustment"> Adjustment Disorder</label>
        <label><input type="radio" name="pre_q5" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q5" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q5" value="SAD"> Social Anxiety Disorder</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="preSubmit">Submit quiz</button>
    </div>
    <div id="preError" class="error"></div>
  </div>

  <!-- BASELINE INSTRUCTION -->
  <div id="baselineInstruction" class="card screen hidden">
    <h2>Lesson: Anxiety & Trauma-Related Disorders</h2>

    <div class="info-box">
      In this lesson, you will read about several anxiety and trauma-related disorders and then see how
      the patterns show up in real-world cases.
    </div>

    <h3>Core Ideas</h3>
    <p>
      Anxiety and trauma-related disorders exist on a spectrum. Many people feel stress or anxiety in
      response to life events, but not every reaction is a mental disorder. For a clinical diagnosis,
      psychologists look for:
    </p>
    <ul>
      <li><strong>Core symptom pattern</strong> (e.g., persistent worry, sudden panic, intrusive memories)</li>
      <li><strong>Time course</strong> (how long symptoms have been present)</li>
      <li><strong>Trigger or context</strong> (trauma-related vs. free-floating vs. situation-specific)</li>
      <li><strong>Functional impairment</strong> (impact on school, relationships, daily life)</li>
    </ul>

    <h3>Generalized Anxiety Disorder (GAD)</h3>
    <p>
      Generalized Anxiety Disorder involves excessive, hard-to-control worry about <em>multiple</em> areas of life
      (such as school, family, health, or the future) occurring more days than not for at least six months.
      Physical symptoms often include restlessness, fatigue, difficulty concentrating, irritability, muscle tension,
      and sleep disturbance. A key feature is that the worry is <strong>broad</strong> and <strong>persistent</strong>, not tied to a single specific event.
    </p>

    <h3>Panic Disorder</h3>
    <p>
      Panic Disorder centers on recurrent, unexpected panic attacks—sudden surges of intense fear that peak within
      minutes and involve symptoms like heart racing, shortness of breath, dizziness, or a sense of losing control.
      After one or more attacks, people often develop persistent concern about additional attacks and may change
      their behavior (for example, avoiding crowded places or long lines).
    </p>

    <h3>Posttraumatic Stress Disorder (PTSD) and Acute Stress Disorder (ASD)</h3>
    <p>
      Both PTSD and ASD involve exposure to an actual or threatened death, serious injury, or sexual violence.
      People may re-experience the event through intrusive memories, nightmares, or flashbacks, avoid reminders,
      experience negative changes in mood or thinking, and feel hypervigilant or easily startled.
    </p>
    <p>
      The key difference is timing: <strong>Acute Stress Disorder</strong> symptoms occur within the first month
      after the trauma. <strong>Posttraumatic Stress Disorder</strong> involves similar symptom clusters that
      persist for more than one month and cause significant impairment in daily life.
    </p>

    <h3>Adjustment Disorder</h3>
    <p>
      Adjustment Disorders involve emotional or behavioral symptoms that arise in response to an identifiable
      stressor (such as a breakup, a move, or academic pressure). The reaction is more intense than would be
      expected and causes distress or impairment, but the pattern usually does not meet full criteria for PTSD,
      GAD, or other specific disorders. Symptoms typically begin within three months of the stressor and resolve
      within six months after the stressor or its consequences end.
    </p>

    <h3>Social Anxiety Disorder and Specific Phobia</h3>
    <p>
      <strong>Social Anxiety Disorder</strong> is marked by intense fear of one or more social situations in which an individual
      may be scrutinized (such as giving a presentation or eating in front of others), along with avoidance or strong distress.
      <strong>Specific Phobia</strong> involves marked fear of a specific object or situation (such as heights, needles, or dogs).
      In both, panic-like symptoms can occur, but the fear is closely tied to the specific situation.
    </p>

    <h3>Obsessive-Compulsive Disorder (OCD)</h3>
    <p>
      Obsessive-Compulsive Disorder involves intrusive, unwanted thoughts (obsessions) and repetitive behaviors or mental acts
      (compulsions) that the person feels driven to perform. Although OCD often co-occurs with anxiety, the core pattern
      focuses on obsessions and compulsions rather than broad worry or trauma-related intrusions.
    </p>

    <h3>Worked Example 1</h3>
    <p>
      A student survived a serious storm that destroyed parts of their neighborhood. For the next three weeks, they had vivid
      nightmares about the storm, avoided going near damaged buildings, and jumped at any loud wind or thunder sounds. Their
      grades slipped slightly as they found it hard to concentrate.
    </p>
    <p><strong>Reasoning:</strong> There was a qualifying traumatic event (the storm). Symptoms include re-experiencing,
      avoidance, and hyperarousal, but the time frame is under one month. This pattern fits <strong>Acute Stress Disorder</strong>
      rather than PTSD.</p>

    <h3>Worked Example 2</h3>
    <p>
      Another student has experienced intense fear during exams for the last year. Right before each test, their heart races
      and they feel nauseated. However, outside of exam periods, they do not have unexpected panic attacks or ongoing worry
      about having another attack. They attend classes and social events without major difficulty.
    </p>
    <p><strong>Reasoning:</strong> The anxiety is closely tied to a specific performance situation (exams), without broad worry
      or unexpected attacks. This is more consistent with a <strong>Specific Phobia or performance-type Social Anxiety</strong>
      than Panic Disorder or GAD.</p>

    <h3>Practice Questions</h3>
    <p class="small-label">Choose the best diagnosis for each case. You will see which answers are correct after you submit.</p>

    <div class="question">
      <p><strong>Practice 1.</strong> After moving to a new city, Jonah has felt sad and anxious about leaving his old friends.
        For the past two months, he has had trouble sleeping and has skipped a few club meetings. However, he still attends
        school regularly, and his symptoms began soon after the move.</p>
      <div class="options">
        <label><input type="radio" name="base_pr1" value="Adjustment"> Adjustment Disorder</label>
        <label><input type="radio" name="base_pr1" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_pr1" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="base_pr1" value="OCD"> Obsessive-Compulsive Disorder</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Practice 2.</strong> Leo avoids giving presentations in class because he fears that others will judge him
        harshly if he makes a mistake. Before any required presentation, he feels nauseated and shakes. He is generally
        comfortable in small group conversations and does not have unexpected panic attacks at other times.</p>
      <div class="options">
        <label><input type="radio" name="base_pr2" value="SAD"> Social Anxiety Disorder</label>
        <label><input type="radio" name="base_pr2" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="base_pr2" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_pr2" value="SpecificPhobia"> Specific Phobia (heights)</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Practice 3.</strong> For six weeks, Amita has washed her hands repeatedly because she keeps imagining germs
        on doorknobs and desks. She feels temporarily relieved after washing but soon feels compelled to wash again. These
        urges consume over an hour each day and make her late to class.</p>
      <div class="options">
        <label><input type="radio" name="base_pr3" value="OCD"> Obsessive-Compulsive Disorder</label>
        <label><input type="radio" name="base_pr3" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_pr3" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="base_pr3" value="Adjustment"> Adjustment Disorder</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Practice 4.</strong> Three weeks after a natural disaster, a student has trouble sleeping, feels jumpy when
        doors slam, and avoids walking near damaged buildings. They also have repeated images of the event when they close their eyes.</p>
      <div class="options">
        <label><input type="radio" name="base_pr4" value="AcuteStress"> Acute Stress Disorder</label>
        <label><input type="radio" name="base_pr4" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="base_pr4" value="SpecificPhobia"> Specific Phobia (storms)</label>
        <label><input type="radio" name="base_pr4" value="None"> No disorder</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="baselinePracticeSubmit">Check answers</button>
      <button id="baselineContinue" class="secondary" disabled>Continue to quiz</button>
    </div>
    <div id="baselineFeedback" class="feedback"></div>
  </div>

  <!-- METACOGNITIVE ("SPECIAL SAUCE") INSTRUCTION -->
  <div id="guidedInstruction" class="card screen hidden">
    <h2>Lesson: Reading Cues in Anxiety & Trauma Cases</h2>
    <p>
      In this lesson, you will practice noticing key cues in case vignettes—what happened, when symptoms started,
      which symptoms appear, and how daily life is affected.
    </p>

    <div class="info-box">
      As you work, you can always refer back to the cue table. Above each case you will see a
      <strong>“View cue table”</strong> button that opens it in a small panel.
    </div>

    <h3>Cue Table</h3>
    <div class="cue-table-wrapper">
      <table id="mainCueTable">
        <thead>
          <tr>
            <th>Disorder</th>
            <th>Typical Trigger / Context</th>
            <th>Time Course</th>
            <th>Core Symptom Pattern</th>
            <th>Functional Impairment Cues</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Generalized Anxiety Disorder (GAD)</td>
            <td>No single event; broad everyday worries (school, family, future)</td>
            <td>Most days for ≥ 6 months</td>
            <td>Excessive, hard-to-control worry across multiple domains</td>
            <td>Difficulty concentrating, fatigue, sleep problems, impact on grades / daily tasks</td>
          </tr>
          <tr>
            <td>Panic Disorder</td>
            <td>Recurrent, often unexpected panic attacks; fear of more attacks</td>
            <td>Attacks over weeks or months, plus ongoing worry about them</td>
            <td>Sudden surges of fear, heart racing, shortness of breath, dizziness, fear of losing control</td>
            <td>Avoids situations (lines, crowds, buses) because of fear of attacks</td>
          </tr>
          <tr>
            <td>Posttraumatic Stress Disorder (PTSD)</td>
            <td>Exposure to trauma (e.g., assault, serious accident, disaster)</td>
            <td>Symptoms last &gt; 1 month after trauma</td>
            <td>Intrusive memories, nightmares, flashbacks, avoidance, negative mood, hypervigilance</td>
            <td>Missing school, avoiding places, withdrawal from friends, ongoing distress</td>
          </tr>
          <tr>
            <td>Acute Stress Disorder (ASD)</td>
            <td>Exposure to trauma</td>
            <td>Symptoms within 3 days to 1 month after trauma</td>
            <td>Similar clusters to PTSD (intrusions, avoidance, arousal)</td>
            <td>Short-term but noticeable disruption in sleep, concentration, or routine</td>
          </tr>
          <tr>
            <td>Adjustment Disorder</td>
            <td>Identifiable non-traumatic stressor (move, breakup, academic pressure)</td>
            <td>Begins within 3 months of stressor; usually resolves &lt; 6 months after</td>
            <td>Distress out of proportion to stressor, but not full PTSD or GAD pattern</td>
            <td>Drop in grades, social withdrawal, behavior changes linked to the stressor</td>
          </tr>
          <tr>
            <td>Social Anxiety Disorder</td>
            <td>Social or performance situations with possible scrutiny</td>
            <td>Persistent (typically &gt; 6 months)</td>
            <td>Fear of embarrassment or judgment; situational anxiety</td>
            <td>Avoids presentations, parties, or speaking up even when important</td>
          </tr>
          <tr>
            <td>Specific Phobia</td>
            <td>Specific object or situation (heights, animals, needles, storms)</td>
            <td>Chronic unless treated; focused on that stimulus</td>
            <td>Marked fear when facing that object or situation</td>
            <td>Avoids or endures with intense fear; may limit daily activities</td>
          </tr>
          <tr>
            <td>Obsessive-Compulsive Disorder (OCD)</td>
            <td>Intrusive thoughts (obsessions) and repetitive behaviors (compulsions)</td>
            <td>Typically long-lasting without treatment</td>
            <td>Obsessions (e.g., contamination) and rituals (e.g., repeated washing)</td>
            <td>Consumes significant time; interferes with school, routines, or relationships</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- CASE 1: Fully worked and annotated -->
    <h3>Case 1: Annotated Example</h3>
    <p>
      Read the case carefully. Notice how the cues are highlighted and labeled.
    </p>
    <p>
      A student survived a serious <span class="highlight">storm that destroyed parts of their neighborhood</span>
      <span class="inline-note">traumatic event</span>. For the next
      <span class="highlight">three weeks</span>
      <span class="inline-note">time frame &lt; 1 month</span>, they had vivid
      <span class="highlight">nightmares about the storm</span>
      <span class="inline-note">intrusions</span>, avoided going near
      <span class="highlight">damaged buildings</span>
      <span class="inline-note">avoidance</span>, and jumped at loud wind and thunder sounds
      <span class="inline-note">hyperarousal</span>. Their <span class="highlight">grades slipped slightly</span>
      <span class="inline-note">functional impact</span> as they found it hard to concentrate.
    </p>
    <p><strong>Diagnosis:</strong> This pattern matches <strong>Acute Stress Disorder</strong> because
      (1) there is a qualifying trauma, (2) symptoms include intrusions, avoidance, and arousal, and
      (3) they occur within the first month after the event.</p>

    <!-- CASE 2: Prediction + feedback + self-explanation + expert -->
    <h3>Case 2: Your Turn With Support</h3>
    <div class="view-table-inline">
      <button type="button" class="secondary viewCueBtn">View cue table</button>
    </div>
    <p>
      Maya was in a serious car accident ten weeks ago. Since then, she has had
      <span class="highlight">repeated nightmares about the crash</span>, sometimes feels like
      <span class="highlight">she is back in the car again when she hears tires screech</span>,
      and tries hard to <span class="highlight">avoid driving or riding in cars</span>.
      She has started <span class="highlight">missing classes and turning in late work</span>
      because she refuses to travel on certain roads.
    </p>
    <div class="question">
      <p><strong>Q2. Based on the cues above, which diagnosis fits best?</strong></p>
      <div class="options">
        <label><input type="radio" name="case2_diag" value="AcuteStress"> Acute Stress Disorder</label>
        <label><input type="radio" name="case2_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="case2_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="case2_diag" value="Adjustment"> Adjustment Disorder with anxiety</label>
      </div>
      <div class="nav-buttons">
        <button type="button" id="case2Check">Check answer</button>
      </div>
      <div id="case2Feedback" class="feedback"></div>
    </div>

    <div id="case2ExplainBlock" class="hidden">
      <p><strong>Brief reflection:</strong> Write 1–2 cues from the case that led you to your answer.</p>
      <textarea id="case2Reflection" placeholder="For example: length of time since accident, presence of nightmares and flashbacks, avoidance of driving, impact on schoolwork."></textarea>
      <div class="nav-buttons">
        <button type="button" id="case2SubmitReflection">Submit reflection</button>
      </div>
    </div>

    <div id="case2Expert" class="expert-box hidden">
      <strong>Expert reasoning:</strong>
      <p>
        There is a qualifying <em>trauma</em> (serious car accident). Symptoms include
        intrusive memories and flashback-like experiences, avoidance of reminders (driving and certain roads),
        and functional impairment (missing classes, late work). The timeline (about ten weeks after the event)
        means symptoms have lasted longer than one month. Together, these cues support
        <strong>Posttraumatic Stress Disorder</strong> rather than Acute Stress Disorder or Adjustment Disorder.
      </p>
    </div>

    <!-- CASE 3: Similar cycle, no highlighting -->
    <h3>Case 3: Applying the Cue Map</h3>
    <div class="view-table-inline">
      <button type="button" class="secondary viewCueBtn">View cue table</button>
    </div>
    <p>
      For the last seven months, Daniel has worried about a wide range of issues: his grades, his younger
      brother’s health, whether his friends secretly dislike him, and whether his future plans will work out.
      Once he starts worrying, he finds it hard to stop. He often feels tense and tired, has trouble falling
      asleep, and finds it difficult to concentrate in class. There has been no single major trauma, but
      his grades have dropped and he frequently asks family members for reassurance.
    </p>
    <div class="question">
      <p><strong>Q3. Based on the cues above, which diagnosis fits best?</strong></p>
      <div class="options">
        <label><input type="radio" name="case3_diag" value="SAD"> Social Anxiety Disorder</label>
        <label><input type="radio" name="case3_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="case3_diag" value="Adjustment"> Adjustment Disorder with anxiety</label>
        <label><input type="radio" name="case3_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
      </div>
      <div class="nav-buttons">
        <button type="button" id="case3Check">Check answer</button>
      </div>
      <div id="case3Feedback" class="feedback"></div>
    </div>

    <div id="case3ExplainBlock" class="hidden">
      <p><strong>Brief reflection:</strong> Write 1–2 cues from the case that led you to your answer.</p>
      <textarea id="case3Reflection" placeholder="For example: many domains of worry, duration &gt; 6 months, physical symptoms, functional impairment."></textarea>
      <div class="nav-buttons">
        <button type="button" id="case3SubmitReflection">Submit reflection</button>
      </div>
    </div>

    <div id="case3Expert" class="expert-box hidden">
      <strong>Expert reasoning:</strong>
      <p>
        The worry is <em>broad</em> (grades, family, friendships, future), occurs on most days for more than
        six months, is hard to control, and is accompanied by physical symptoms (tension, fatigue, sleep difficulty)
        and functional impairment (drop in grades). There is no single traumatic event, and the worry is not limited
        to one type of situation such as performance or social interaction. These cues support
        <strong>Generalized Anxiety Disorder</strong>.
      </p>
    </div>

    <div class="nav-buttons" style="margin-top: 1.25rem;">
      <button type="button" id="guidedContinue" class="secondary" disabled>Continue to quiz</button>
    </div>
    <div id="guidedHint" class="small-label">
      Complete both reflections to unlock the final quiz.
    </div>
  </div>

  <!-- CUE TABLE OVERLAY (for guided condition) -->
<div id="cueOverlay" class="hidden" style="
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    align-items: center;
    justify-content: center;
    z-index: 50;
  ">
  <div style="
      background: #ffffff;
      max-width: 800px;
      max-height: 80vh;
      width: 95%;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      padding: 1rem 1.25rem;
      overflow: auto;
    ">
    <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom:0.5rem;">
      <strong>Cue Table (Reference)</strong>
      <button type="button" id="closeCueOverlay" class="secondary">Close</button>
    </div>
    <div class="cue-table-wrapper" id="overlayCueContainer">
      <!-- table will be cloned here -->
    </div>
  </div>
</div>


  <!-- POST-TEST -->
  <div id="posttestScreen" class="card screen hidden">
    <h2>Case Quiz: After the Lesson</h2>
    <p>The vignettes below again ask you to choose the diagnosis that best fits each description.</p>

    <div class="question">
      <p><strong>Post Q1.</strong> A year after surviving a serious car accident, Maya still has frequent nightmares about
        the crash, avoids driving or riding in cars, and feels jumpy when she hears screeching tires. She sometimes
        feels like she is back in the car again and has started missing classes because she refuses to travel on certain roads.</p>
      <div class="options">
        <label><input type="radio" name="post_q1" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q1" value="AcuteStress"> Acute Stress Disorder</label>
        <label><input type="radio" name="post_q1" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q1" value="SpecificPhobia"> Specific Phobia (driving)</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q2.</strong> For the past six months, Daniel has worried almost every day about school performance,
        his younger sister’s health, whether his friends secretly dislike him, and his future plans. The worries feel
        excessive and hard to control once they start. He often feels tense and tired, has trouble falling asleep, and
        finds it difficult to concentrate in class. There has been no single traumatic event, but his grades have dropped
        and he frequently asks family members for reassurance.</p>
      <div class="options">
        <label><input type="radio" name="post_q2" value="SAD"> Social Anxiety Disorder</label>
        <label><input type="radio" name="post_q2" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q2" value="Adjustment"> Adjustment Disorder with anxiety</label>
        <label><input type="radio" name="post_q2" value="OCD"> Obsessive-Compulsive Disorder</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q3.</strong> While sitting in a quiet classroom, Serena suddenly feels a wave of intense fear.
        Her heart races, she feels short of breath and dizzy, and she worries she might faint or lose control.
        The feelings peak within minutes and then gradually fade. Over the next month, she has several similar
        episodes that seem to come “out of nowhere.” Between episodes she worries about the next one and begins
        avoiding long bus rides and crowded hallways.</p>
      <div class="options">
        <label><input type="radio" name="post_q3" value="SpecificPhobia"> Specific Phobia (crowds)</label>
        <label><input type="radio" name="post_q3" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q3" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q3" value="Adjustment"> Adjustment Disorder with anxiety</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q4.</strong> For the past nine months, Amira has worried almost every day about multiple topics:
        exams, family finances, her grandmother’s health, and whether she is “making the right choices” about the future.
        The worries feel difficult to control and continue even when things are going well. She has muscle tension, feels
        fatigued, and reports that the worry often keeps her awake at night. The pattern has made it harder to focus during
        the day and keep up with assignments.</p>
      <div class="options">
        <label><input type="radio" name="post_q4" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q4" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q4" value="SAD"> Social Anxiety Disorder</label>
        <label><input type="radio" name="post_q4" value="Panic"> Panic Disorder</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q5.</strong> In the two weeks before major exams, Leo feels more nervous than usual, checks his notes
        repeatedly, and has a few nights of lighter sleep. After the exams are over, his sleep returns to normal, he enjoys
        hanging out with friends again, and his grades remain strong. Outside of exam periods, he does not experience ongoing
        worry or major changes in his daily routine.</p>
      <div class="options">
        <label><input type="radio" name="post_q5" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q5" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q5" value="None"> Typical exam-related stress (no disorder)</label>
        <label><input type="radio" name="post_q5" value="Panic"> Panic Disorder</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="postSubmit">Submit</button>
    </div>
    <div id="postError" class="error"></div>
    <div id="submitStatus" class="feedback"></div>
  </div>

</main>

<script>
  // ====== CONFIG ======
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxPzDgnDddCYiNI2UVS85MiT7fQ1rFT3hEuq31CeZQbcxTambqfPcmDrKfwQTSQzweF6g/exec";

  const preAnswerKey = {
    pre_q1: "GAD",
    pre_q2: "Panic",
    pre_q3: "PTSD",
    pre_q4: "Panic",
    pre_q5: "GAD"
  };

  const postAnswerKey = {
    post_q1: "PTSD",
    post_q2: "GAD",
    post_q3: "Panic",
    post_q4: "GAD",
    post_q5: "None"
  };

  // ====== STATE ======
  let condition = null; // "baseline" or "metacognitive"
  let participantId = null;
  let tableViewCount = 0;

  let preStartTime = null;
  let instructionStartTime = null;
  let postStartTime = null;
  let totalStartTime = Date.now();

  let preDurationSec = null;
  let instructionDurationSec = null;
  let postDurationSec = null;

  const responses = {};

  // ====== HELPERS ======
  function $(id) {
    return document.getElementById(id);
  }

  function showScreen(id) {
    document.querySelectorAll(".screen").forEach(div => div.classList.add("hidden"));
    $(id).classList.remove("hidden");
  }

  function scoreMCQ(prefix, answerKey) {
    let score = 0;
    Object.keys(answerKey).forEach(q => {
      const name = q;
      const selected = document.querySelector(`input[name="${name}"]:checked`);
      if (selected && selected.value === answerKey[q]) {
        score += 1;
      }
      responses[q] = selected ? selected.value : "";
    });
    return score;
  }

  function allAnswered(prefix, count) {
    for (let i = 1; i <= count; i++) {
      const name = `${prefix}_q${i}`;
      const selected = document.querySelector(`input[name="${name}"]:checked`);
      if (!selected) return false;
    }
    return true;
  }

  function randomCondition() {
    return Math.random() < 0.5 ? "baseline" : "metacognitive";
  }

  function secondsBetween(start, end) {
    return ((end - start) / 1000).toFixed(3);
  }

  function generateParticipantId() {
    const t = Date.now();
    const r = Math.floor(Math.random() * 100000);
    return `P_${t}_${r}`;
  }

  // ====== START FLOW ======
  $("startBtn").addEventListener("click", () => {
    participantId = generateParticipantId();
    preStartTime = Date.now();
    showScreen("pretestScreen");
  });

  // ====== PRETEST SUBMIT ======
  $("preSubmit").addEventListener("click", () => {
    $("preError").textContent = "";
    if (!allAnswered("pre", 5)) {
      $("preError").textContent = "Please answer all questions before continuing.";
      return;
    }

    const preEnd = Date.now();
    preDurationSec = secondsBetween(preStartTime, preEnd);

    const preScore = scoreMCQ("pre", preAnswerKey);
    responses.pre_mcq_score = preScore;

    condition = randomCondition();
    responses.condition = condition;
    responses.participantId = participantId;

    instructionStartTime = Date.now();

    if (condition === "baseline") {
      showScreen("baselineInstruction");
    } else {
      showScreen("guidedInstruction");
    }
  });

  // ====== BASELINE PRACTICE SUBMIT ======
  $("baselinePracticeSubmit").addEventListener("click", () => {
    const practiceAnswers = {
      base_pr1: "Adjustment",
      base_pr2: "SAD",
      base_pr3: "OCD",
      base_pr4: "AcuteStress"
    };
    let correct = 0;
    let attemptedAll = true;
    Object.keys(practiceAnswers).forEach(name => {
      const selected = document.querySelector(`input[name="${name}"]:checked`);
      if (!selected) {
        attemptedAll = false;
      } else if (selected.value === practiceAnswers[name]) {
        correct++;
      }
    });

    if (!attemptedAll) {
      $("baselineFeedback").textContent = "Please answer all practice questions before checking your answers.";
      return;
    }

    $("baselineFeedback").textContent =
      `You answered ${correct} out of 4 practice questions correctly. You can adjust your thinking before moving on.`;
    $("baselineContinue").disabled = false;
  });

  $("baselineContinue").addEventListener("click", () => {
    const instEnd = Date.now();
    instructionDurationSec = secondsBetween(instructionStartTime, instEnd);
    postStartTime = Date.now();
    showScreen("posttestScreen");
  });

  // ====== GUIDED / METACOGNITIVE CASES ======

  // Cue table overlay setup
  const overlay = $("cueOverlay");
  const overlayContainer = $("overlayCueContainer");
  const mainCueTable = $("mainCueTable");

  function openCueOverlay() {
    if (mainCueTable && overlayContainer && overlay) {
      overlayContainer.innerHTML = "";
      const clone = mainCueTable.cloneNode(true);
      overlayContainer.appendChild(clone);
      overlay.classList.remove("hidden");
      tableViewCount++;
    }
  }

  document.querySelectorAll(".viewCueBtn").forEach(btn => {
    btn.addEventListener("click", openCueOverlay);
  });

  $("closeCueOverlay").addEventListener("click", () => {
    overlay.classList.add("hidden");
  });

  // Case 2: prediction + feedback + self-explanation + expert
  let case2Completed = false;
  let case3Completed = false;

  $("case2Check").addEventListener("click", () => {
    const selected = document.querySelector('input[name="case2_diag"]:checked');
    const fb = $("case2Feedback");
    fb.textContent = "";

    if (!selected) {
      fb.textContent = "Please choose an option before checking your answer.";
      return;
    }

    if (selected.value === "PTSD") {
      fb.textContent = "Correct. Now pause and explain which cues helped you decide.";
      $("case2ExplainBlock").classList.remove("hidden");
    } else {
      fb.textContent = "Not quite. Look again at the timing and the presence of trauma and functional impairment, then try again.";
    }
  });

  $("case2SubmitReflection").addEventListener("click", () => {
    const text = $("case2Reflection").value.trim();
    if (!text) {
      alert("Please write 1–2 cues that guided your answer.");
      return;
    }
    responses.c2_self_explanation = text;
    responses.c2_final_diag = "PTSD";
    $("case2Expert").classList.remove("hidden");
    case2Completed = true;
    if (case2Completed && case3Completed) {
      $("guidedContinue").disabled = false;
      $("guidedHint").textContent = "You can now continue to the final quiz.";
    }
  });

  // Case 3
  $("case3Check").addEventListener("click", () => {
    const selected = document.querySelector('input[name="case3_diag"]:checked');
    const fb = $("case3Feedback");
    fb.textContent = "";

    if (!selected) {
      fb.textContent = "Please choose an option before checking your answer.";
      return;
    }

    if (selected.value === "GAD") {
      fb.textContent = "Correct. Now pause and explain which cues helped you decide.";
      $("case3ExplainBlock").classList.remove("hidden");
    } else {
      fb.textContent = "Not quite. Notice how many areas of life the worry touches and how long it has lasted, then try again.";
    }
  });

  $("case3SubmitReflection").addEventListener("click", () => {
    const text = $("case3Reflection").value.trim();
    if (!text) {
      alert("Please write 1–2 cues that guided your answer.");
      return;
    }
    responses.c3_self_explanation = text;
    responses.c3_final_diag = "GAD";
    $("case3Expert").classList.remove("hidden");
    case3Completed = true;
    if (case2Completed && case3Completed) {
      $("guidedContinue").disabled = false;
      $("guidedHint").textContent = "You can now continue to the final quiz.";
    }
  });

  $("guidedContinue").addEventListener("click", () => {
    const instEnd = Date.now();
    instructionDurationSec = secondsBetween(instructionStartTime, instEnd);
    postStartTime = Date.now();
    showScreen("posttestScreen");
  });

  // ====== POSTTEST SUBMIT & SEND DATA ======
  $("postSubmit").addEventListener("click", () => {
    $("postError").textContent = "";
    $("submitStatus").textContent = "";

    if (!allAnswered("post", 5)) {
      $("postError").textContent = "Please answer all questions before submitting.";
      return;
    }

    const postEnd = Date.now();
    postDurationSec = secondsBetween(postStartTime, postEnd);
    const totalEnd = postEnd;
    const totalDurationSec = secondsBetween(totalStartTime, totalEnd);

    const postScore = scoreMCQ("post", postAnswerKey);
    responses.post_mcq_score = postScore;

    const preScore = responses.pre_mcq_score || 0;
    responses.gain_mcq_score = postScore - preScore;

    responses.timestamp_client = new Date().toISOString();
    responses.pre_duration_sec = preDurationSec;
    responses.instruction_duration_sec = instructionDurationSec;
    responses.post_duration_sec = postDurationSec;
    responses.total_duration_sec = totalDurationSec;
    responses.table_view_count = tableViewCount;
    responses.participantId = participantId;
    responses.condition = condition;

    $("postSubmit").disabled = true;

    fetch(SCRIPT_URL, {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(responses)
    }).then(() => {
      $("submitStatus").textContent = "Thanks! Your responses have been submitted.";
    }).catch(() => {
      $("postError").textContent =
        "There was an error submitting your responses. You can screenshot this page if needed.";
    });
  });
</script>
</body>
</html>
