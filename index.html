<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AP Psych – Anxiety & Trauma Disorders Lesson</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #f7f7fb;
      color: #222;
    }

    .app-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    h1, h2, h3 {
      margin-top: 0;
    }

    .card {
      background: #fff;
      border-radius: 10px;
      padding: 20px 22px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      margin-bottom: 18px;
    }

    .hidden {
      display: none;
    }

    button {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      background: #1f6feb;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      margin-top: 10px;
    }

    button.secondary {
      background: #e0e4f4;
      color: #111;
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .question {
      margin-bottom: 16px;
    }

    .question p {
      margin: 0 0 6px 0;
    }

    .options label {
      display: block;
      margin-bottom: 4px;
      cursor: pointer;
    }

    .nav-buttons {
      margin-top: 16px;
      display: flex;
      gap: 8px;
    }

    .error {
      color: #b00020;
      margin-top: 8px;
      font-size: 0.9rem;
    }

    .success {
      color: #0b7a2a;
      margin-top: 8px;
      font-size: 0.95rem;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      font-family: inherit;
      font-size: 0.95rem;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      resize: vertical;
    }

    .vignette {
      background: #f5f7ff;
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 8px;
      border: 1px solid #e1e4ff;
      font-size: 0.95rem;
    }

    .feedback {
      font-size: 0.9rem;
      margin-top: 6px;
    }

    .feedback.correct {
      color: #0b7a2a;
    }

    .feedback.incorrect {
      color: #b00020;
    }

    .cue-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: 6px;
    }

    .cue-table th,
    .cue-table td {
      border: 1px solid #d1d5db;
      padding: 6px 8px;
      vertical-align: top;
    }

    .cue-table th {
      background: #edf2ff;
      text-align: left;
    }

    .view-table-row {
      text-align: right;
      margin-top: 4px;
      margin-bottom: 8px;
    }

    .inline-btn {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #e5ecff;
      color: #11327b;
      border: none;
      cursor: pointer;
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal {
      background: #fff;
      max-width: 720px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      border-radius: 10px;
      padding: 16px 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .modal-header h3 {
      margin: 0;
    }

    .linkish {
      color: #1f6feb;
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .highlight {
      font-weight: 600;
    }

    .small-note {
      font-size: 0.85rem;
      color: #555;
      margin-top: 4px;
    }
  </style>
</head>
<body>
<div class="app-container">
  <div id="welcomeScreen" class="card">
    <h1>AP Psychology: Anxiety & Trauma-Related Disorders</h1>
    <p>
      In this short module, you will:
    </p>
    <ul>
      <li>Complete a short quiz about diagnosis from case vignettes (pre-test).</li>
      <li>Work through a brief online lesson on anxiety and trauma-related disorders.</li>
      <li>Complete a second short quiz (post-test).</li>
    </ul>
    <p>This should take about 12–18 minutes.</p>
    <button id="startBtn">Start</button>
  </div>

  <!-- PRE-TEST -->
  <div id="pretestScreen" class="card hidden">
    <h2>Pre-Quiz: Case-Based Diagnosis</h2>
    <p>Read each vignette and select the most appropriate diagnosis.</p>

    <div class="question">
      <p><strong>Pre Q1.</strong> Alex has spent the last six months feeling tense and “on edge” most days. They worry about school, health, and their family even when nothing obvious is wrong. They have trouble sleeping, feel fatigued, and find it hard to concentrate. The worry feels excessive and difficult to control.</p>
      <div class="options">
        <label><input type="radio" name="pre_q1" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q1" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q1" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q1" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q2.</strong> Sam experiences sudden surges of intense fear that peak within minutes. During these episodes, Sam’s heart races, they feel short of breath, dizzy, and worry they might be “going crazy” or dying. The attacks are unexpected, and now Sam fears having more in public places.</p>
      <div class="options">
        <label><input type="radio" name="pre_q2" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q2" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q2" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q2" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q3.</strong> A year after surviving a serious car accident, Maya still has frequent nightmares about the crash, avoids driving or even getting into cars, and feels jumpy when she hears screeching tires. She sometimes feels like she is back in the car again and has difficulty sleeping.</p>
      <div class="options">
        <label><input type="radio" name="pre_q3" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q3" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q3" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q3" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q4.</strong> Jordan often feels restless and keyed up, but their main difficulty is brief, intense episodes of fear with chest pain and a sense of losing control that seem to come “out of the blue.” Between episodes, Jordan worries a lot about having another attack and avoids places where escape would be hard.</p>
      <div class="options">
        <label><input type="radio" name="pre_q4" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q4" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q4" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q4" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q5.</strong> For the past eight months, Lina has worried “about everything” most days, including grades, friendships, and the future. The worries feel difficult to shut off, and she notices muscle tension and poor sleep. There is no single specific trauma that triggered this pattern.</p>
      <div class="options">
        <label><input type="radio" name="pre_q5" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q5" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q5" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q5" value="None"> None of these</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="preSubmit">Submit pre-quiz</button>
    </div>
    <div id="preError" class="error"></div>
  </div>

  <!-- BASELINE INSTRUCTION -->
  <div id="baselineInstruction" class="card hidden">
    <h2>Lesson: Anxiety & Trauma-Related Disorders (Text-Based)</h2>

    <p>
      This brief lesson introduces three disorders that often appear in AP Psychology units on anxiety and trauma:
      <strong>Generalized Anxiety Disorder (GAD)</strong>, <strong>Panic Disorder</strong>, and
      <strong>Posttraumatic Stress Disorder (PTSD)</strong>. Each diagnosis involves both characteristic symptoms
      and clear <span class="highlight">functional impairment</span> in daily life.
    </p>

    <h3>Generalized Anxiety Disorder (GAD)</h3>
    <p>
      GAD involves <span class="highlight">excessive and hard-to-control worry</span> about multiple domains
      (school, work, health, family) on more days than not for at least six months. People with GAD often experience
      symptoms such as restlessness, fatigue, difficulty concentrating, irritability, muscle tension, and sleep
      disturbance. The anxiety causes significant distress or problems functioning at school, work, or in relationships.
    </p>

    <h3>Panic Disorder</h3>
    <p>
      Panic Disorder is defined by recurrent, unexpected <span class="highlight">panic attacks</span>. A panic attack
      is a sudden surge of intense fear or discomfort that peaks within minutes and includes physical symptoms
      (e.g., heart palpitations, sweating, trembling, shortness of breath, chest pain, dizziness) and fears of
      losing control, “going crazy,” or dying. At least one attack is followed by a month or more of persistent
      concern about additional attacks and/or maladaptive changes in behavior (such as avoiding exercise or public
      places). These symptoms interfere with everyday life.
    </p>

    <h3>Posttraumatic Stress Disorder (PTSD)</h3>
    <p>
      PTSD follows exposure to a <span class="highlight">traumatic event</span> involving actual or threatened serious
      injury, sexual violence, or death. Core features include intrusive memories or flashbacks, avoidance of reminders,
      negative changes in mood and thinking, and changes in arousal (e.g., being jumpy, irritable, or hyper-vigilant).
      Symptoms last more than one month and lead to clinically significant distress or impairment in functioning.
    </p>

    <h3>Worked Examples (Baseline)</h3>

    <div class="vignette">
      <strong>Worked Example 1.</strong> Taylor frequently has nightmares about a severe storm that destroyed their home.
      Taylor avoids news about storms, feels detached from friends, and startles easily when thunder rumbles. Symptoms
      began soon after the disaster and have persisted for over a year, interfering with school attendance and social life.
    </div>
    <p><strong>Most appropriate diagnosis?</strong> <em>Posttraumatic Stress Disorder</em> because there is a clear trauma,
      ongoing intrusive reminders, avoidance, negative mood changes, and functional impairment lasting more than one month.</p>

    <div class="vignette">
      <strong>Worked Example 2.</strong> Riley has occasional worry about exams but otherwise functions well. Worries are
      brief, tied to specific deadlines, and do not cause sleep problems or major distress.
    </div>
    <p><strong>Most appropriate diagnosis?</strong> <em>No disorder</em>. The worry is situational and does not cause
      significant functional impairment.</p>

    <h3>Practice Questions (Baseline)</h3>
    <p>Answer the questions below. After you submit all four, you will see which diagnoses were correct.</p>

    <div class="question">
      <p><strong>Practice B1.</strong> Jamie has had repeated unexpected episodes of intense fear with heart pounding,
        sweating, and fear of dying. The episodes peak within minutes and are followed by weeks of worrying about when the
        next episode will occur. Jamie has started avoiding crowded buses.</p>
      <div class="options">
        <label><input type="radio" name="base_p1" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="base_p1" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_p1" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="base_p1" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Practice B2.</strong> Over the past seven months, Noor has worried nearly every day about grades, family,
        and the future. They describe the worry as “constant background noise” that is hard to switch off. Noor feels tired,
        has tense muscles, and finds it hard to focus in class.</p>
      <div class="options">
        <label><input type="radio" name="base_p2" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_p2" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="base_p2" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="base_p2" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Practice B3.</strong> A few weeks after being robbed at gunpoint, Eli has started avoiding the street
        where it happened, has trouble sleeping because of vivid memories, and feels constantly on guard. School attendance
        has dropped because Eli feels unsafe outside the house.</p>
      <div class="options">
        <label><input type="radio" name="base_p3" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="base_p3" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="base_p3" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_p3" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Practice B4.</strong> Maria occasionally has short episodes of worry before presentations. These episodes
        last under an hour, do not involve strong physical symptoms, and do not interfere with daily life.</p>
      <div class="options">
        <label><input type="radio" name="base_p4" value="None"> None of these</label>
        <label><input type="radio" name="base_p4" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="base_p4" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_p4" value="PTSD"> Posttraumatic Stress Disorder</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="baselineCheck">Submit practice</button>
      <button id="baselineNext" disabled>Continue to post-quiz</button>
    </div>
    <div id="baselineFeedback" class="feedback"></div>
  </div>

  <!-- SPECIAL SAUCE INSTRUCTION -->
  <div id="guidedInstruction" class="card hidden">
    <h2>Guided Lesson: Using Diagnostic Cues</h2>
    <p>
      This version of the lesson focuses on <span class="highlight">learning by doing</span>,
      <span class="highlight">immediate feedback</span>, and short
      <span class="highlight">metacognitive reflections</span> about which cues you used.
    </p>

    <h3>Key Diagnostic Cues</h3>
    <p class="small-note">
      Scan the table below. You can pull it up again later while answering questions.
    </p>
    <table class="cue-table">
      <thead>
      <tr>
        <th>Disorder</th>
        <th>Core cues</th>
        <th>Functional impairment examples</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td><strong>Generalized Anxiety Disorder (GAD)</strong></td>
        <td>
          &bull; Excessive, hard-to-control worry about multiple domains<br>
          &bull; Symptoms &gt; 6 months<br>
          &bull; Restlessness, fatigue, poor concentration, muscle tension, poor sleep
        </td>
        <td>
          &bull; Declining grades due to constant worry<br>
          &bull; Difficulty relaxing enough to spend time with friends<br>
          &bull; Sleep disruption affecting daily functioning
        </td>
      </tr>
      <tr>
        <td><strong>Panic Disorder</strong></td>
        <td>
          &bull; Recurrent, unexpected panic attacks<br>
          &bull; Sudden surges of intense fear peaking within minutes<br>
          &bull; Physical symptoms (heart racing, shortness of breath, chest pain, dizziness)<br>
          &bull; Persistent concern about more attacks, avoidance of triggers
        </td>
        <td>
          &bull; Avoiding exercise or crowded places for fear of attacks<br>
          &bull; Missing school or work to avoid potential attacks
        </td>
      </tr>
      <tr>
        <td><strong>Posttraumatic Stress Disorder (PTSD)</strong></td>
        <td>
          &bull; Clear traumatic event involving serious injury, violence, or threat<br>
          &bull; Intrusions (flashbacks, nightmares)<br>
          &bull; Avoidance of reminders<br>
          &bull; Negative mood/cognition changes<br>
          &bull; Hyperarousal (jumpy, on guard)
        </td>
        <td>
          &bull; Avoiding places or people linked to the trauma<br>
          &bull; Difficulty sleeping or concentrating at school<br>
          &bull; Withdrawal from relationships
        </td>
      </tr>
      </tbody>
    </table>

    <!-- modal for cue table -->
    <div id="tableModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h3>Cue Table</h3>
          <span id="closeTableModal" class="linkish">Close</span>
        </div>
        <table class="cue-table">
          <thead>
          <tr>
            <th>Disorder</th>
            <th>Core cues</th>
            <th>Functional impairment examples</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td><strong>Generalized Anxiety Disorder (GAD)</strong></td>
            <td>
              &bull; Excessive, hard-to-control worry about multiple domains<br>
              &bull; Symptoms &gt; 6 months<br>
              &bull; Restlessness, fatigue, poor concentration, muscle tension, poor sleep
            </td>
            <td>
              &bull; Declining grades due to constant worry<br>
              &bull; Difficulty relaxing enough to spend time with friends<br>
              &bull; Sleep disruption affecting daily functioning
            </td>
          </tr>
          <tr>
            <td><strong>Panic Disorder</strong></td>
            <td>
              &bull; Recurrent, unexpected panic attacks<br>
              &bull; Sudden surges of intense fear peaking within minutes<br>
              &bull; Physical symptoms (heart racing, shortness of breath, chest pain, dizziness)<br>
              &bull; Persistent concern about more attacks, avoidance of triggers
            </td>
            <td>
              &bull; Avoiding exercise or crowded places for fear of attacks<br>
              &bull; Missing school or work to avoid potential attacks
            </td>
          </tr>
          <tr>
            <td><strong>Posttraumatic Stress Disorder (PTSD)</strong></td>
            <td>
              &bull; Clear traumatic event involving serious injury, violence, or threat<br>
              &bull; Intrusions (flashbacks, nightmares)<br>
              &bull; Avoidance of reminders<br>
              &bull; Negative mood/cognition changes<br>
              &bull; Hyperarousal (jumpy, on guard)
            </td>
            <td>
              &bull; Avoiding places or people linked to the trauma<br>
              &bull; Difficulty sleeping or concentrating at school<br>
              &bull; Withdrawal from relationships
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Case 1: Annotated worked example -->
    <h3>Case 1: Annotated Example</h3>
    <div class="view-table-row">
      <button type="button" class="inline-btn" data-view-table>View cue table</button>
    </div>
    <div class="vignette">
      <strong>Case 1.</strong> Taylor frequently has nightmares about a severe storm that destroyed their home.
      Taylor avoids news about storms, feels detached from friends, and startles easily when thunder rumbles.
      Symptoms began soon after the disaster and have persisted for over a year, interfering with school attendance
      and social life.
      <ul>
        <li><span class="highlight">Clear trauma:</span> severe storm destroying home.</li>
        <li><span class="highlight">Intrusions:</span> nightmares about the disaster.</li>
        <li><span class="highlight">Avoidance:</span> avoiding news about storms.</li>
        <li><span class="highlight">Negative mood/withdrawal:</span> detached from friends.</li>
        <li><span class="highlight">Hyperarousal:</span> startles easily.</li>
        <li><span class="highlight">Functional impairment &gt; 1 month:</span> school and social life affected for a year.</li>
      </ul>
    </div>

    <div class="question">
      <p><strong>Q1.</strong> Based on these cues, what is the most appropriate diagnosis?</p>
      <div class="options">
        <label><input type="radio" name="g1_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="g1_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="g1_diag" value="Panic"> Panic Disorder</label>
      </div>
      <button type="button" id="g1Check">Check Answer</button>
      <div id="g1Feedback" class="feedback"></div>
    </div>

    <!-- Case 2: iterative with reflection -->
    <h3>Case 2: Guided Practice with Reflection</h3>
    <div class="view-table-row">
      <button type="button" class="inline-btn" data-view-table>View cue table</button>
    </div>
    <div class="vignette">
      <strong>Case 2.</strong> Jordan often feels restless and “keyed up,” but their most distressing experiences are
      <span class="highlight">brief surges of intense fear</span> that peak within minutes. During these episodes Jordan’s
      <span class="highlight">heart races</span>, breathing feels difficult, and they worry they might be “going crazy”
      or dying. The episodes are <span class="highlight">unexpected</span>, and in between Jordan spends weeks worrying
      about having another attack and <span class="highlight">avoids crowded buses</span> where escape might be hard.
    </div>

    <div class="question">
      <p><strong>Q2.</strong> What diagnosis best fits Case 2?</p>
      <div class="options">
        <label><input type="radio" name="g2_diag" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="g2_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="g2_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="g2_diag" value="None"> None of these</label>
      </div>
      <button type="button" id="g2Check">Check diagnosis</button>
      <div id="g2Feedback" class="feedback"></div>
    </div>

    <div id="g2ReflectionBlock" class="hidden">
      <p><strong>Brief reflection:</strong> Write 1–2 specific cues that led you to your diagnosis for Case 2.</p>
      <textarea id="g2Reflection"></textarea>
      <button type="button" id="g2SubmitReflection">Submit reflection</button>
      <div id="g2ReflectionFeedback" class="feedback"></div>
    </div>

    <div id="g2ExpertBlock" class="hidden small-note">
      <p><strong>Expert reasoning (Case 2):</strong> This pattern fits Panic Disorder: recurrent, unexpected panic attacks
        with physical symptoms and ongoing worry and avoidance that impair daily life.</p>
    </div>

    <!-- Case 3: similar structure, fewer highlighted cues -->
    <h3>Case 3: Independent Practice with Reflection</h3>
    <div class="view-table-row">
      <button type="button" class="inline-btn" data-view-table>View cue table</button>
    </div>
    <div class="vignette">
      <strong>Case 3.</strong> For the past eight months, Lina has worried “about everything” most days, including grades,
      friendships, and the future. The worries feel difficult to shut off, and Lina notices muscle tension and poor sleep.
      There is no single specific trauma that triggered this pattern, but the constant worry has made it harder to keep
      up with schoolwork and enjoy time with friends.
    </div>

    <div class="question">
      <p><strong>Q3.</strong> What diagnosis best fits Case 3?</p>
      <div class="options">
        <label><input type="radio" name="g3_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="g3_diag" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="g3_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="g3_diag" value="None"> None of these</label>
      </div>
      <button type="button" id="g3Check">Check diagnosis</button>
      <div id="g3Feedback" class="feedback"></div>
    </div>

    <div id="g3ReflectionBlock" class="hidden">
      <p><strong>Brief reflection:</strong> Write 1–2 specific cues that led you to your diagnosis for Case 3.</p>
      <textarea id="g3Reflection"></textarea>
      <button type="button" id="g3SubmitReflection">Submit reflection</button>
      <div id="g3ReflectionFeedback" class="feedback"></div>
    </div>

    <div id="g3ExpertBlock" class="hidden small-note">
      <p><strong>Expert reasoning (Case 3):</strong> The long duration of excessive, hard-to-control worry across many
        domains, together with physical symptoms and functional impairment, fits Generalized Anxiety Disorder.</p>
    </div>

    <!-- Additional special-sauce practice with Check Answer -->
    <h3>Quick Check Questions</h3>

    <div class="view-table-row">
      <button type="button" class="inline-btn" data-view-table>View cue table</button>
    </div>
    <div class="vignette">
      <strong>Case 4.</strong> A month after a serious car accident, Maya has frequent nightmares about the crash, avoids
      driving or riding in cars, and feels jumpy when hearing screeching brakes. Schoolwork is suffering because Maya
      refuses to commute.
    </div>
    <div class="question">
      <p><strong>Q4.</strong> What diagnosis best fits Case 4?</p>
      <div class="options">
        <label><input type="radio" name="g4_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="g4_diag" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="g4_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="g4_diag" value="None"> None of these</label>
      </div>
      <button type="button" id="g4Check">Check Answer</button>
      <div id="g4Feedback" class="feedback"></div>
    </div>

    <div class="view-table-row">
      <button type="button" class="inline-btn" data-view-table>View cue table</button>
    </div>
    <div class="vignette">
      <strong>Case 5.</strong> Devon worries intensely for a week before major exams and has some trouble sleeping during
      that week, but otherwise feels fine and functions well in daily life. The worries are tied to specific deadlines
      and resolve afterward.</div>
    <div class="question">
      <p><strong>Q5.</strong> What diagnosis best fits Case 5?</p>
      <div class="options">
        <label><input type="radio" name="g5_diag" value="None"> None of these</label>
        <label><input type="radio" name="g5_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="g5_diag" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="g5_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
      </div>
      <button type="button" id="g5Check">Check Answer</button>
      <div id="g5Feedback" class="feedback"></div>
    </div>

    <div class="nav-buttons">
      <button id="guidedNext">Continue to post-quiz</button>
    </div>
  </div>

  <!-- POST-TEST -->
  <div id="posttestScreen" class="card hidden">
    <h2>Post-Quiz: Case-Based Diagnosis</h2>
    <p>Same style as before: read each vignette and select the most appropriate diagnosis.</p>

    <!-- reuse same structure / cues, different order -->
    <div class="question">
      <p><strong>Post Q1.</strong> A year after surviving a serious car accident, Maya still has frequent nightmares about
        the crash, avoids driving, and feels jumpy when hearing screeching brakes. She sometimes feels like she is back in
        the car again and is missing classes because of avoidance.</p>
      <div class="options">
        <label><input type="radio" name="post_q1" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q1" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q1" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q1" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q2.</strong> Alex has spent the last six months feeling tense and “on edge” most days. They worry
        about school, health, and their family even when nothing obvious is wrong. They have trouble sleeping, feel
        fatigued, and find it hard to concentrate. The worry feels excessive and difficult to control.</p>
      <div class="options">
        <label><input type="radio" name="post_q2" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q2" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q2" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q2" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q3.</strong> Sam experiences sudden surges of intense fear that peak within minutes. During these
        episodes, Sam’s heart races, they feel short of breath, dizzy, and worry they might be “going crazy” or dying.
        The attacks are unexpected, and now Sam fears having more in public places.</p>
      <div class="options">
        <label><input type="radio" name="post_q3" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q3" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q3" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q3" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q4.</strong> For the past eight months, Lina has worried “about everything” most days, including
        grades, friendships, and the future. The worries feel difficult to shut off, and she notices muscle tension and
        poor sleep. The worry has started to interfere with schoolwork.</p>
      <div class="options">
        <label><input type="radio" name="post_q4" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q4" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q4" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q4" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q5.</strong> Devon worries intensely for a week before major exams and has some trouble sleeping
        during that week, but otherwise feels fine and functions well in daily life. The worries are tied to specific
        deadlines and resolve afterward.</p>
      <div class="options">
        <label><input type="radio" name="post_q5" value="None"> None of these</label>
        <label><input type="radio" name="post_q5" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q5" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q5" value="PTSD"> Posttraumatic Stress Disorder</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="postSubmit">Submit post-quiz</button>
    </div>
    <div id="postError" class="error"></div>
    <div id="submitStatus" class="feedback"></div>
  </div>

  <!-- FINAL SCREEN -->
  <div id="finalScreen" class="card hidden">
    <h2>Thank you!</h2>
    <p>Your responses have been recorded.</p>
  </div>
</div>

<script>
  // === CONFIG ===
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxPzDgnDddCYiNI2UVS85MiT7fQ1rFT3hEuq31CeZQbcxTambqfPcmDrKfwQTSQzweF6g/exec";

  // === STATE ===
  let participantId = null;
  let condition = null; // "baseline" or "special_sauce"

  let preStartTime = null;
  let preEndTime = null;
  let instructionStartTime = null;
  let instructionEndTime = null;
  let postStartTime = null;
  let postEndTime = null;

  let preAnswers = {};
  let postAnswers = {};

  let c2Attempts = 0;
  let c2AttemptHistory = [];
  let c2FinalDiag = "";
  let c2SelfExplanation = "";

  let c3FinalDiag = "";
  let c3SelfExplanation = "";

  let tableViewCount = 0;

  function generateParticipantId() {
    return "P_" + Date.now() + "_" + Math.floor(Math.random() * 100000);
  }

  function showScreen(id) {
    document.getElementById("welcomeScreen").classList.add("hidden");
    document.getElementById("pretestScreen").classList.add("hidden");
    document.getElementById("baselineInstruction").classList.add("hidden");
    document.getElementById("guidedInstruction").classList.add("hidden");
    document.getElementById("posttestScreen").classList.add("hidden");
    document.getElementById("finalScreen").classList.add("hidden");
    document.getElementById(id).classList.remove("hidden");
  }

  function getSelectedValue(name) {
    const radios = document.querySelectorAll(`input[name="${name}"]`);
    for (const r of radios) {
      if (r.checked) return r.value;
    }
    return "";
  }

  function computePreScore() {
    // answer key: [GAD, Panic, PTSD, Panic, GAD]
    const key = {
      pre_q1: "GAD",
      pre_q2: "Panic",
      pre_q3: "PTSD",
      pre_q4: "Panic",
      pre_q5: "GAD"
    };
    let score = 0;
    Object.keys(key).forEach(q => {
      if (preAnswers[q] === key[q]) score++;
    });
    return score;
  }

  function computePostScore() {
    const key = {
      post_q1: "PTSD",
      post_q2: "GAD",
      post_q3: "Panic",
      post_q4: "GAD",
      post_q5: "None"
    };
    let score = 0;
    Object.keys(key).forEach(q => {
      if (postAnswers[q] === key[q]) score++;
    });
    return score;
  }

  // === EVENT HOOKUP ===
  document.getElementById("startBtn").addEventListener("click", () => {
    participantId = generateParticipantId();
    preStartTime = Date.now();
    showScreen("pretestScreen");
  });

  document.getElementById("preSubmit").addEventListener("click", () => {
    const errEl = document.getElementById("preError");
    errEl.textContent = "";
    const qNames = ["pre_q1", "pre_q2", "pre_q3", "pre_q4", "pre_q5"];
    for (const q of qNames) {
      const v = getSelectedValue(q);
      if (!v) {
        errEl.textContent = "Please answer all questions before continuing.";
        return;
      }
      preAnswers[q] = v;
    }
    preEndTime = Date.now();

    // Assign condition randomly
    condition = Math.random() < 0.5 ? "baseline" : "special_sauce";

    instructionStartTime = Date.now();
    if (condition === "baseline") {
      showScreen("baselineInstruction");
    } else {
      showScreen("guidedInstruction");
    }
  });

  // Baseline practice feedback
  document.getElementById("baselineCheck").addEventListener("click", () => {
    const fb = document.getElementById("baselineFeedback");
    fb.classList.remove("correct", "incorrect");
    // We only show corrective feedback, not full explanations
    const answers = {
      base_p1: "Panic",
      base_p2: "GAD",
      base_p3: "PTSD",
      base_p4: "None"
    };
    let allAnswered = true;
    let correctCount = 0;
    Object.keys(answers).forEach(name => {
      const v = getSelectedValue(name);
      if (!v) allAnswered = false;
      if (v === answers[name]) correctCount++;
    });
    if (!allAnswered) {
      fb.textContent = "Please answer all four practice questions.";
      fb.classList.add("incorrect");
      return;
    }
    fb.textContent = `You got ${correctCount} out of 4 practice questions correct. Correct answers have been recorded in your mind—move on to the post-quiz when you’re ready.`;
    fb.classList.add("correct");
    document.getElementById("baselineNext").disabled = false;
  });

  document.getElementById("baselineNext").addEventListener("click", () => {
    instructionEndTime = Date.now();
    postStartTime = Date.now();
    showScreen("posttestScreen");
  });

  // Special sauce: cue table modal
  document.querySelectorAll("[data-view-table]").forEach(btn => {
    btn.addEventListener("click", () => {
      tableViewCount++;
      document.getElementById("tableModal").style.display = "flex";
    });
  });
  document.getElementById("closeTableModal").addEventListener("click", () => {
    document.getElementById("tableModal").style.display = "none";
  });

  // Special sauce Case 1 check
  document.getElementById("g1Check").addEventListener("click", () => {
    const fb = document.getElementById("g1Feedback");
    fb.classList.remove("correct", "incorrect");
    const v = getSelectedValue("g1_diag");
    if (!v) {
      fb.textContent = "Please select a diagnosis first.";
      fb.classList.add("incorrect");
      return;
    }
    if (v === "PTSD") {
      fb.textContent = "Correct: the trauma, intrusions, avoidance, and long-lasting functional impairment fit PTSD.";
      fb.classList.add("correct");
    } else {
      fb.textContent = "Not quite. The clear trauma plus nightmares, avoidance, and long-term impairment point more strongly to PTSD.";
      fb.classList.add("incorrect");
    }
  });

  // Special sauce Case 2 check with attempts + reflection
  document.getElementById("g2Check").addEventListener("click", () => {
    const fb = document.getElementById("g2Feedback");
    fb.classList.remove("correct", "incorrect");
    const v = getSelectedValue("g2_diag");
    if (!v) {
      fb.textContent = "Please select a diagnosis first.";
      fb.classList.add("incorrect");
      return;
    }
    c2Attempts++;
    c2AttemptHistory.push(v);

    if (v === "Panic") {
      fb.textContent = "Correct. Sudden, intense surges of fear with physical symptoms and ongoing avoidance fit Panic Disorder.";
      fb.classList.add("correct");
      c2FinalDiag = "Panic";
      document.getElementById("g2ReflectionBlock").classList.remove("hidden");
    } else {
      fb.textContent = "Not quite. Focus on the sudden, brief attacks that peak within minutes and the ongoing worry about more attacks.";
      fb.classList.add("incorrect");
    }
  });

  document.getElementById("g2SubmitReflection").addEventListener("click", () => {
    const txt = document.getElementById("g2Reflection").value.trim();
    const fb = document.getElementById("g2ReflectionFeedback");
    fb.classList.remove("correct", "incorrect");
    if (!txt) {
      fb.textContent = "Please write 1–2 cues that led you to your diagnosis.";
      fb.classList.add("incorrect");
      return;
    }
    c2SelfExplanation = txt;
    fb.textContent = "Reflection submitted. Compare your reasoning with the expert explanation below.";
    fb.classList.add("correct");
    document.getElementById("g2ExpertBlock").classList.remove("hidden");
  });

  // Special sauce Case 3 check + reflection
  document.getElementById("g3Check").addEventListener("click", () => {
    const fb = document.getElementById("g3Feedback");
    fb.classList.remove("correct", "incorrect");
    const v = getSelectedValue("g3_diag");
    if (!v) {
      fb.textContent = "Please select a diagnosis first.";
      fb.classList.add("incorrect");
      return;
    }
    if (v === "GAD") {
      fb.textContent = "Correct. Long-term, excessive worry across many domains with physical symptoms fits GAD.";
      fb.classList.add("correct");
      c3FinalDiag = "GAD";
      document.getElementById("g3ReflectionBlock").classList.remove("hidden");
    } else {
      fb.textContent = "Not quite. Pay attention to the long duration and broad pattern of worry rather than brief episodes.";
      fb.classList.add("incorrect");
    }
  });

  document.getElementById("g3SubmitReflection").addEventListener("click", () => {
    const txt = document.getElementById("g3Reflection").value.trim();
    const fb = document.getElementById("g3ReflectionFeedback");
    fb.classList.remove("correct", "incorrect");
    if (!txt) {
      fb.textContent = "Please write 1–2 cues that led you to your diagnosis.";
      fb.classList.add("incorrect");
      return;
    }
    c3SelfExplanation = txt;
    fb.textContent = "Reflection submitted. Compare your reasoning with the expert explanation below.";
    fb.classList.add("correct");
    document.getElementById("g3ExpertBlock").classList.remove("hidden");
  });

  // Special sauce Q4, Q5 check answer
  document.getElementById("g4Check").addEventListener("click", () => {
    const fb = document.getElementById("g4Feedback");
    fb.classList.remove("correct", "incorrect");
    const v = getSelectedValue("g4_diag");
    if (!v) {
      fb.textContent = "Please select a diagnosis first.";
      fb.classList.add("incorrect");
      return;
    }
    if (v === "PTSD") {
      fb.textContent = "Correct. Clear trauma, intrusions, avoidance, and functional impairment point to PTSD.";
      fb.classList.add("correct");
    } else {
      fb.textContent = "Not quite. The trauma plus nightmares, avoidance, and impaired commuting are central cues for PTSD.";
      fb.classList.add("incorrect");
    }
  });

  document.getElementById("g5Check").addEventListener("click", () => {
    const fb = document.getElementById("g5Feedback");
    fb.classList.remove("correct", "incorrect");
    const v = getSelectedValue("g5_diag");
    if (!v) {
      fb.textContent = "Please select a diagnosis first.";
      fb.classList.add("incorrect");
      return;
    }
    if (v === "None") {
      fb.textContent = "Correct. Worry is situational and short-term, with no clear functional impairment or pervasive anxiety.";
      fb.classList.add("correct");
    } else {
      fb.textContent = "Not quite. Look at duration, specificity, and degree of impairment before assigning a disorder.";
      fb.classList.add("incorrect");
    }
  });

  document.getElementById("guidedNext").addEventListener("click", () => {
    instructionEndTime = Date.now();
    postStartTime = Date.now();
    showScreen("posttestScreen");
  });

  // Post-test submit
  document.getElementById("postSubmit").addEventListener("click", () => {
    const errEl = document.getElementById("postError");
    errEl.textContent = "";
    const qNames = ["post_q1", "post_q2", "post_q3", "post_q4", "post_q5"];
    for (const q of qNames) {
      const v = getSelectedValue(q);
      if (!v) {
        errEl.textContent = "Please answer all questions before submitting.";
        return;
      }
      postAnswers[q] = v;
    }
    postEndTime = Date.now();

    // For baseline condition, no guided diagnostics
    if (condition === "baseline") {
      c2Attempts = 0;
      c2AttemptHistory = [];
      c2FinalDiag = "";
      c2SelfExplanation = "";
      c3FinalDiag = "";
      c3SelfExplanation = "";
      tableViewCount = 0;
    }

    submitAllData();
  });

  function submitAllData() {
    const submitStatus = document.getElementById("submitStatus");
    submitStatus.textContent = "";
    submitStatus.classList.remove("correct", "incorrect");

    const preScore = computePreScore();
    const postScore = computePostScore();
    const gain = postScore - preScore;

    const preDur = preEndTime && preStartTime ? (preEndTime - preStartTime) / 1000 : "";
    const instDur = instructionEndTime && instructionStartTime ? (instructionEndTime - instructionStartTime) / 1000 : "";
    const postDur = postEndTime && postStartTime ? (postEndTime - postStartTime) / 1000 : "";
    const totalDur = postEndTime && preStartTime ? (postEndTime - preStartTime) / 1000 : "";

    const payload = {
      timestamp_client: new Date().toISOString(),
      participantId: participantId,
      condition: condition || "",
      pre_q1: preAnswers["pre_q1"] || "",
      pre_q2: preAnswers["pre_q2"] || "",
      pre_q3: preAnswers["pre_q3"] || "",
      pre_q4: preAnswers["pre_q4"] || "",
      pre_q5: preAnswers["pre_q5"] || "",
      post_q1: postAnswers["post_q1"] || "",
      post_q2: postAnswers["post_q2"] || "",
      post_q3: postAnswers["post_q3"] || "",
      post_q4: postAnswers["post_q4"] || "",
      post_q5: postAnswers["post_q5"] || "",
      pre_mcq_score: preScore,
      post_mcq_score: postScore,
      gain_mcq_score: gain,
      c2_attempts: c2Attempts,
      c2_attempt_history: c2AttemptHistory,
      table_view_count: tableViewCount,
      pre_duration_sec: preDur,
      instruction_duration_sec: instDur,
      post_duration_sec: postDur,
      total_duration_sec: totalDur,
      c2_final_diag: c2FinalDiag,
      c2_self_explanation: c2SelfExplanation,
      c3_final_diag: c3FinalDiag,
      c3_self_explanation: c3SelfExplanation
    };

    fetch(SCRIPT_URL, {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    }).then(() => {
      submitStatus.textContent = "Responses submitted.";
      submitStatus.classList.add("correct");
      showScreen("finalScreen");
    }).catch(err => {
      console.error(err);
      submitStatus.textContent = "There was an error submitting your responses. Please screenshot this page.";
      submitStatus.classList.add("incorrect");
    });
  }
</script>
</body>
</html>
