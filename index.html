<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AP Psych Mini-Lesson: Anxiety & Trauma-Related Disorders</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem;
      line-height: 1.5;
    }
    h1, h2, h3 {
      margin-top: 1.2rem;
    }
    .hidden { display: none !important; }
    .btn {
      padding: 0.5rem 1rem;
      border-radius: 4px;
      border: 1px solid #333;
      background: #f5f5f5;
      cursor: pointer;
      margin-top: 1rem;
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .q-block {
      margin: 1rem 0;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #fafafa;
    }
    .options label {
      display: block;
      margin: 0.15rem 0;
    }
    textarea {
      width: 100%;
      min-height: 70px;
      padding: 0.5rem;
      font-family: inherit;
      font-size: 0.95rem;
    }
    .small-note {
      font-size: 0.85rem;
      color: #555;
    }
    .section-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #777;
      margin-bottom: 0.3rem;
      display: block;
    }
    .pill {
      display: inline-block;
      padding: 0.1rem 0.4rem;
      border-radius: 999px;
      background: #e0ecff;
      font-size: 0.8rem;
      margin-right: 0.25rem;
    }
    .annotated {
      background: #f0f6ff;
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px solid #d0e0ff;
    }
    .hint, .feedback-box {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #333;
      padding: 0.4rem;
      background: #fffbe6;
      border: 1px dashed #e0c76b;
      border-radius: 4px;
    }
    .feedback-box.correct {
      background: #e9ffe9;
      border-color: #7ac27a;
    }
    .feedback-box.incorrect {
      background: #ffe9e9;
      border-color: #d97a7a;
    }
    .cue-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    .cue-table th,
    .cue-table td {
      border: 1px solid #ddd;
      padding: 0.35rem;
      vertical-align: top;
    }
    .cue-table th {
      background: #f3f6ff;
    }
    .highlight {
      font-weight: 600;
      background: #fff4c2;
    }
    .right-controls {
      text-align: right;
      margin-top: 0.25rem;
    }

    /* full-table overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 40px;
      z-index: 1000;
    }
    .overlay-inner {
      background: #fff;
      max-width: 900px;
      width: 95%;
      max-height: 80vh;
      overflow: auto;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    .overlay-inner h3 {
      margin-top: 0;
    }
    .overlay-close {
      float: right;
      border: none;
      background: transparent;
      font-size: 1.1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="app">

  <!-- PART 0: INTRO -->
  <section id="welcome-section">
    <h1>AP Psych Mini-Lesson: Anxiety & Trauma-Related Disorders</h1>
    <p>
      This mini-lesson will help you practice answering AP-style case questions about anxiety and trauma-related disorders.
    </p>
    <ul>
      <li>Quick warm-up quiz</li>
      <li>Short online lesson</li>
      <li>Practice quiz</li>
    </ul>

    <div class="q-block">
      <label for="pid"><strong>Participant ID</strong> (initials or a nickname)</label>
      <input id="pid" type="text" style="width:100%;padding:0.4rem;" />
    </div>

    <div class="q-block">
      <label>
        <input id="consent" type="checkbox" />
        I understand this is a practice lesson and agree that my anonymous responses can be used to improve it.
      </label>
    </div>

    <button class="btn" id="start-btn" disabled>Start</button>
  </section>

  <!-- PART 1: PRETEST -->
  <section id="pretest-section" class="">
    <span class="section-label">Part 1</span>
    <h2>Warm-up Quiz</h2>
    <p>For each question, use the cues in the vignette to choose the best answer.</p>

    <form id="pretest-form">
      <!-- Pre Q1 -->
      <div class="q-block">
        <strong>Question 1</strong>
        <p>
          Case A: For the past eight months, Arjun has been worrying almost daily about grades, friendships,
          and his future. He reports muscle tension and difficulty sleeping. No specific traumatic event is mentioned.
        </p>
        <p>
          Case B: Two months after a serious car accident, Elena has intrusive memories, avoids driving,
          and has trouble sleeping. Her grades have dropped.
        </p>
        <p>Which statement is most accurate?</p>
        <div class="options">
          <label>
            <input type="radio" name="pre_q1" value="GAD_only" />
            Case A is more consistent with Generalized Anxiety Disorder and Case B is more consistent with Post-Traumatic Stress Disorder.
          </label>
          <label>
            <input type="radio" name="pre_q1" value="ASD_only" />
            Case A is more consistent with Acute Stress Disorder and Case B is more consistent with Generalized Anxiety Disorder.
          </label>
          <label>
            <input type="radio" name="pre_q1" value="none" />
            Neither description provides enough information to link to specific disorders.
          </label>
          <label>
            <input type="radio" name="pre_q1" value="all" />
            Both cases could fit any anxiety or trauma-related disorder equally well.
          </label>
        </div>
      </div>

      <!-- Pre Q2 -->
      <div class="q-block">
        <strong>Question 2</strong>
        <p>
          A student is describing two clients with trauma-related symptoms. In Case C, symptoms have lasted ten days.
          In Case D, similar symptoms have continued for three months.
        </p>
        <p>Assuming symptoms are otherwise similar, which pairing best matches DSM-style duration cues?</p>
        <div class="options">
          <label>
            <input type="radio" name="pre_q2" value="ASD_PTSD" />
            Case C is more consistent with Acute Stress Disorder and Case D is more consistent with Post-Traumatic Stress Disorder.
          </label>
          <label>
            <input type="radio" name="pre_q2" value="PTSD_ASD" />
            Case C is more consistent with Post-Traumatic Stress Disorder and Case D is more consistent with Acute Stress Disorder.
          </label>
          <label>
            <input type="radio" name="pre_q2" value="none" />
            Duration alone is never useful when distinguishing these disorders.
          </label>
          <label>
            <input type="radio" name="pre_q2" value="all" />
            Both cases could only be diagnosed as Generalized Anxiety Disorder.
          </label>
        </div>
      </div>

      <!-- Pre Q3 -->
      <div class="q-block">
        <strong>Question 3</strong>
        <p>
          Nina wants to discriminate between Panic Disorder and Generalized Anxiety Disorder in AP Psych FRQs.
          Which cue would most strongly push a case toward Panic Disorder?
        </p>
        <div class="options">
          <label>
            <input type="radio" name="pre_q3" value="sudden_fear" />
            Sudden episodes of intense fear that peak within minutes and occur unexpectedly.
          </label>
          <label>
            <input type="radio" name="pre_q3" value="six_months_worry" />
            Worry present most days for at least six months about multiple life areas.
          </label>
          <label>
            <input type="radio" name="pre_q3" value="none" />
            Panic Disorder is defined only by whether the person had a trauma.
          </label>
          <label>
            <input type="radio" name="pre_q3" value="all" />
            All of the above are equally central to Panic Disorder.
          </label>
        </div>
      </div>

      <!-- Pre Q4 -->
      <div class="q-block">
        <strong>Question 4</strong>
        <p>
          Two students have similar symptoms after a traumatic event, but only one has stopped going to school and is failing classes.
        </p>
        <p>Which statement best uses the idea of functional impairment?</p>
        <div class="options">
          <label>
            <input type="radio" name="pre_q4" value="impairment_matters" />
            Functional impairment helps distinguish a normal stress reaction from a trauma-related disorder.
          </label>
          <label>
            <input type="radio" name="pre_q4" value="impairment_never" />
            Functional impairment is not part of diagnostic decisions for trauma-related disorders.
          </label>
          <label>
            <input type="radio" name="pre_q4" value="none" />
            Only the presence of nightmares matters for diagnosis.
          </label>
          <label>
            <input type="radio" name="pre_q4" value="all" />
            All reactions after trauma automatically count as Post-Traumatic Stress Disorder.
          </label>
        </div>
      </div>

      <!-- Pre Q5 -->
      <div class="q-block">
        <strong>Question 5</strong>
        <p>
          A case describes months of broad worry about everyday events with no mention of any traumatic event.
          Which options can you rule out <em>first</em> using that cue?
        </p>
        <div class="options">
          <label>
            <input type="radio" name="pre_q5" value="rule_out_trauma_disorders" />
            Post-Traumatic Stress Disorder and Acute Stress Disorder.
          </label>
          <label>
            <input type="radio" name="pre_q5" value="rule_out_GAD" />
            Generalized Anxiety Disorder only.
          </label>
          <label>
            <input type="radio" name="pre_q5" value="none" />
            No disorders can ever be ruled out based on trauma history.
          </label>
          <label>
            <input type="radio" name="pre_q5" value="all" />
            All the disorders discussed must be ruled out.
          </label>
        </div>
      </div>

      <button type="button" class="btn" id="pretest-next-btn">Next: Lesson</button>
    </form>
  </section>

  <!-- PART 2A: BASELINE INSTRUCTION -->
  <section id="instruction-baseline" class="hidden">
    <span class="section-label">Part 2</span>
    <h2>Lesson: Anxiety & Trauma-Related Disorders</h2>

    <form id="instruction-baseline-form">
      <div class="q-block">
        <h3>Overview</h3>
        <p>
          Stress is the process by which we perceive and respond to events we appraise as threatening or challenging.
          Anxiety disorders involve excessive fear or anxiety that is difficult to control and causes distress or impairment.
        </p>
        <p>
          <strong>Generalized Anxiety Disorder</strong> involves excessive anxiety and worry occurring more days than not for
          at least six months, about a number of events or activities. The worry is difficult to control and is often
          associated with restlessness, fatigue, difficulty concentrating, irritability, muscle tension, or sleep disturbance.
        </p>
        <p>
          <strong>Panic Disorder</strong> involves recurrent, unexpected panic attacks, along with persistent concern or
          behavior change lasting at least one month after the attacks. Panic attacks are abrupt surges of intense fear that
          reach a peak within minutes and include physical symptoms such as heart palpitations or shortness of breath.
        </p>
        <p>
          <strong>Acute Stress Disorder</strong> involves symptoms that begin after a traumatic event and last from three days
          to one month. Symptoms can include intrusive memories, negative mood, dissociation, avoidance, and arousal.
        </p>
        <p>
          <strong>Post-Traumatic Stress Disorder</strong> involves exposure to actual or threatened death, serious injury, or sexual violence,
          followed by intrusive symptoms, avoidance, negative changes in cognition and mood, and arousal changes.
          Duration is more than one month and symptoms cause significant functional impairment.
        </p>
      </div>

      <!-- Worked examples -->
      <div class="q-block">
        <p>
          Example 1: Maria was in a car accident two weeks ago. Since then, she has intrusive memories, difficulty sleeping,
          and irritability. Her symptoms began soon after the trauma and have lasted for under one month.
          This pattern is consistent with Acute Stress Disorder.
        </p>
      </div>

      <div class="q-block">
        <p>
          Example 2: For the past eight months, Amir has felt on edge most days. He worries about grades, his parents' health,
          friendships, and money. He reports muscle tension and difficulty sleeping, and says he “cannot turn off” the worry.
          There was no single traumatic event that started these symptoms. This pattern is consistent with Generalized Anxiety Disorder.
        </p>
      </div>

      <div class="q-block">
        <p>
          Example 3: Over the past month, Jordan has had several sudden episodes of intense fear that peak within minutes.
          During these episodes, Jordan feels short of breath and fears losing control. The episodes occur unexpectedly,
          and Jordan now avoids crowded spaces and worries about having another attack. This pattern is consistent with Panic Disorder.
        </p>
      </div>

      <!-- Practice with corrective feedback -->
      <div class="q-block">
        <h3>Practice Check</h3>

        <p><strong>Case A.</strong> A student was caught in a tornado that destroyed their home. Five weeks later,
          they report intrusive memories, avoidance of weather alerts, difficulty sleeping, and trouble concentrating at school.</p>
        <p>Which diagnosis best fits?</p>
        <div class="options">
          <label><input type="radio" name="instA_q1" value="PTSD" /> Post-Traumatic Stress Disorder</label>
          <label><input type="radio" name="instA_q1" value="ASD" /> Acute Stress Disorder</label>
          <label><input type="radio" name="instA_q1" value="GAD" /> Generalized Anxiety Disorder</label>
          <label><input type="radio" name="instA_q1" value="Panic" /> Panic Disorder</label>
        </div>

        <p><strong>Case B.</strong> For the past month, another student has had several sudden surges of fear that peak within minutes,
          with heart pounding and shortness of breath. The episodes happen unexpectedly, and the student now avoids leaving home alone
          and worries about having another attack.</p>
        <p>Which diagnosis best fits?</p>
        <div class="options">
          <label><input type="radio" name="instA_q2" value="Panic" /> Panic Disorder</label>
          <label><input type="radio" name="instA_q2" value="GAD" /> Generalized Anxiety Disorder</label>
          <label><input type="radio" name="instA_q2" value="ASD" /> Acute Stress Disorder</label>
          <label><input type="radio" name="instA_q2" value="PTSD" /> Post-Traumatic Stress Disorder</label>
        </div>

        <p><strong>Case C.</strong> For the past seven months, Noor has experienced near-daily worry about school performance,
          family, and future plans. She feels restless, has difficulty concentrating, and reports that the worry feels uncontrollable.
          No clear traumatic event is mentioned.</p>
        <p>Which diagnosis best fits?</p>
        <div class="options">
          <label><input type="radio" name="instA_q3" value="GAD" /> Generalized Anxiety Disorder</label>
          <label><input type="radio" name="instA_q3" value="Panic" /> Panic Disorder</label>
          <label><input type="radio" name="instA_q3" value="ASD" /> Acute Stress Disorder</label>
          <label><input type="radio" name="instA_q3" value="PTSD" /> Post-Traumatic Stress Disorder</label>
        </div>

        <p><strong>Case D.</strong> Ten days after a serious car crash, Evan has intrusive memories of the crash,
          trouble sleeping, and avoids riding in cars. These symptoms interfere with his daily life.</p>
        <p>Which diagnosis best fits?</p>
        <div class="options">
          <label><input type="radio" name="instA_q4" value="ASD" /> Acute Stress Disorder</label>
          <label><input type="radio" name="instA_q4" value="PTSD" /> Post-Traumatic Stress Disorder</label>
          <label><input type="radio" name="instA_q4" value="GAD" /> Generalized Anxiety Disorder</label>
          <label><input type="radio" name="instA_q4" value="Panic" /> Panic Disorder</label>
        </div>

        <button type="button" class="btn" id="baseline-check-btn">Check my answers</button>
        <div id="baseline-feedback" class="hint hidden"></div>
      </div>

      <button type="button" class="btn" id="instruction-baseline-next-btn" disabled>Next: Practice Quiz</button>
    </form>
  </section>

  <!-- PART 2B: SPECIAL SAUCE INSTRUCTION -->
  <section id="instruction-special" class="hidden">
    <span class="section-label">Part 2</span>
    <h2>Guided Lesson: Practicing Diagnostic Cues</h2>

    <!-- SINGLE IN-DEPTH TABLE AT TOP -->
    <div class="q-block">
      <h3>Diagnostic Cue Table</h3>
      <p class="small-note">
        Use this table to see how trigger, duration, symptom pattern, and functional impairment work together
        to distinguish these disorders.
      </p>
      <table class="cue-table">
        <thead>
          <tr>
            <th>Disorder</th>
            <th>Trigger</th>
            <th>Duration</th>
            <th>Key Symptoms / Pattern</th>
            <th>Functional Impairment</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Generalized Anxiety Disorder</td>
            <td>No single trauma; worry about many everyday areas</td>
            <td>At least 6 months, most days</td>
            <td>Broad, uncontrollable worry plus physical symptoms (e.g., tension, sleep problems)</td>
            <td>Distress or interference with daily functioning (school, relationships, etc.)</td>
          </tr>
          <tr>
            <td>Panic Disorder</td>
            <td>Often no clear trigger; unexpected panic attacks</td>
            <td>Recurrent attacks plus &ge; 1 month concern or behavior change</td>
            <td>Sudden fear surges and ongoing fear of future attacks</td>
            <td>Avoidance (e.g., of crowds or leaving home) that interferes with daily life</td>
          </tr>
          <tr>
            <td>Acute Stress Disorder</td>
            <td>Clear trauma (accident, assault, disaster)</td>
            <td>3 days to 1 month after trauma</td>
            <td>Intrusions, negative mood, dissociation, avoidance, arousal</td>
            <td>Symptoms cause distress or functional problems but duration is under 1 month</td>
          </tr>
          <tr>
            <td>Post-Traumatic Stress Disorder</td>
            <td>Clear trauma</td>
            <td>More than 1 month after trauma</td>
            <td>Intrusions, avoidance, negative mood/cognitions, arousal</td>
            <td>Significant functional impairment (school, work, sleep, relationships)</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p class="small-note">
      Now practice using these cues in case examples. While you work through the questions, you can reopen the cue table using the button on the right.
    </p>

    <div class="right-controls">
      <button type="button" class="btn" id="show-table-btn">
        View cue table
      </button>
    </div>

    <form id="instruction-special-form">
      <!-- Case 1: annotated find-the-cue -->
      <div class="q-block">
        <h3>Case 1 (Annotated)</h3>
        <p class="small-note">This first case is annotated to show how each cue type appears in a vignette.</p>
        <div class="annotated">
          <span class="pill">Trigger</span> Jamie witnessed a robbery at work.<br/>
          <span class="pill">Duration</span> For the past two weeks,<br/>
          <span class="pill">Symptoms</span> she has nightmares, avoids returning to the store, and feels constantly on edge.<br/>
          <span class="pill">Functional impairment</span> She has missed multiple shifts due to fear.
        </div>

        <p>Now answer some quick find-the-cue questions based on the annotations:</p>
        <div class="options">
          <label>How long have Jamie’s symptoms lasted?
            <select name="instB_c1_dur">
              <option value="">Select...</option>
              <option value="2_weeks">Two weeks</option>
              <option value="2_months">Two months</option>
              <option value="8_months">Eight months</option>
            </select>
          </label>
        </div>
        <div class="options">
          <label>Is there a traumatic event?
            <select name="instB_c1_trig">
              <option value="">Select...</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </label>
        </div>
        <div class="options">
          <label>Is her functioning impaired?
            <select name="instB_c1_impair">
              <option value="">Select...</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </label>
        </div>

        <p>Based on these cues, which diagnosis is most consistent?</p>
        <div class="options">
          <label><input type="radio" name="instB_c1_diag" value="ASD" /> Acute Stress Disorder</label>
          <label><input type="radio" name="instB_c1_diag" value="PTSD" /> Post-Traumatic Stress Disorder</label>
          <label><input type="radio" name="instB_c1_diag" value="GAD" /> Generalized Anxiety Disorder</label>
          <label><input type="radio" name="instB_c1_diag" value="Panic" /> Panic Disorder</label>
        </div>
      </div>

      <!-- Case 2: guided with highlighted cues -->
      <div class="q-block" id="special-case2">
        <h3>Case 2</h3>
        <p>
          For the last <span class="highlight">eight months</span>, Alex experiences
          <span class="highlight">near-daily worry</span>,
          <span class="highlight">muscle tension</span>, and irritability.
          His worry spans <span class="highlight">school, family, and finances</span> and feels
          <span class="highlight">uncontrollable</span>.
          There is <span class="highlight">no specific traumatic event</span> mentioned.
        </p>

        <p>Based on the cues you noticed, what diagnosis fits best?</p>
        <div class="options" id="c2-options">
          <label><input type="radio" name="instB_c2_diag" value="GAD" /> Generalized Anxiety Disorder</label>
          <label><input type="radio" name="instB_c2_diag" value="PTSD" /> Post-Traumatic Stress Disorder</label>
          <label><input type="radio" name="instB_c2_diag" value="Panic" /> Panic Disorder</label>
          <label><input type="radio" name="instB_c2_diag" value="ASD" /> Acute Stress Disorder</label>
        </div>
        <button type="button" class="btn" id="c2-submit-btn">Submit answer</button>

        <div id="c2-feedback" class="feedback-box hidden"></div>

        <div id="c2-selfex-block" class="hidden">
          <p>Now that you reached a plausible answer, briefly explain your reasoning:</p>
          <ol>
            <li>Which cue mattered most (e.g., duration, trigger)?</li>
            <li>Where in the vignette did you see it?</li>
            <li>Which other diagnosis did that cue help you rule out?</li>
          </ol>
          <textarea id="c2-selfex" name="instB_c2_selfex"></textarea>
          <button type="button" class="btn" id="c2-reflect-btn">Submit reflection</button>

          <div id="c2-expert" class="hint hidden">
            Expert reasoning: the long duration (more than six months), lack of a single trauma,
            and broad, uncontrollable worry across multiple domains are the core cues for Generalized Anxiety Disorder.
          </div>
        </div>
      </div>

      <!-- Case 3: same structure, no highlighting -->
      <div class="q-block" id="special-case3">
        <h3>Case 3</h3>
        <p>
          Sam experiences sudden episodes of intense fear that peak within minutes. These episodes occur unpredictably.
          After several episodes, Sam avoids leaving home alone and worries frequently about having another attack.
          No trauma is mentioned.
        </p>

        <p>Which diagnosis is most consistent with this description?</p>
        <div class="options" id="c3-options">
          <label><input type="radio" name="instB_c3_diag" value="Panic" /> Panic Disorder</label>
          <label><input type="radio" name="instB_c3_diag" value="ASD" /> Acute Stress Disorder</label>
          <label><input type="radio" name="instB_c3_diag" value="PTSD" /> Post-Traumatic Stress Disorder</label>
          <label><input type="radio" name="instB_c3_diag" value="GAD" /> Generalized Anxiety Disorder</label>
        </div>
        <button type="button" class="btn" id="c3-submit-btn">Submit answer</button>

        <div id="c3-feedback" class="feedback-box hidden"></div>

        <div id="c3-selfex-block" class="hidden">
          <p>Briefly describe one or two cues that led you to your choice.</p>
          <textarea id="c3-selfex" name="instB_c3_selfex"></textarea>
          <button type="button" class="btn" id="c3-reflect-btn">Submit reflection</button>

          <div id="c3-expert" class="hint hidden">
            Expert reasoning: abrupt, unexpected fear surges plus ongoing fear of future attacks and avoidance of leaving home
            are classic cues for Panic Disorder rather than trauma-related disorders or Generalized Anxiety Disorder.
          </div>
        </div>
      </div>

      <button type="button" class="btn" id="instruction-special-next-btn">Next: Practice Quiz</button>
    </form>
  </section>

  <!-- CUE TABLE OVERLAY -->
  <div id="cue-table-overlay" class="overlay hidden">
    <div class="overlay-inner">
      <button class="overlay-close" id="close-table-btn" aria-label="Close">&times;</button>
      <h3>Diagnostic Cue Table</h3>
      <p class="small-note">You can scroll this table while staying on your current question.</p>
      <table class="cue-table">
        <thead>
          <tr>
            <th>Disorder</th>
            <th>Trigger</th>
            <th>Duration</th>
            <th>Key Symptoms / Pattern</th>
            <th>Functional Impairment</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Generalized Anxiety Disorder</td>
            <td>No single trauma; worry about many everyday areas</td>
            <td>At least 6 months, most days</td>
            <td>Broad, uncontrollable worry plus physical symptoms (e.g., tension, sleep problems)</td>
            <td>Distress or interference with daily functioning (school, relationships, etc.)</td>
          </tr>
          <tr>
            <td>Panic Disorder</td>
            <td>Often no clear trigger; unexpected panic attacks</td>
            <td>Recurrent attacks plus &ge; 1 month concern or behavior change</td>
            <td>Sudden fear surges and ongoing fear of future attacks</td>
            <td>Avoidance (e.g., of crowds or leaving home) that interferes with daily life</td>
          </tr>
          <tr>
            <td>Acute Stress Disorder</td>
            <td>Clear trauma (accident, assault, disaster)</td>
            <td>3 days to 1 month after trauma</td>
            <td>Intrusions, negative mood, dissociation, avoidance, arousal</td>
            <td>Symptoms cause distress or functional problems but duration is under 1 month</td>
          </tr>
          <tr>
            <td>Post-Traumatic Stress Disorder</td>
            <td>Clear trauma</td>
            <td>More than 1 month after trauma</td>
            <td>Intrusions, avoidance, negative mood/cognitions, arousal</td>
            <td>Significant functional impairment (school, work, sleep, relationships)</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- PART 3: POSTTEST -->
  <section id="posttest-section" class="hidden">
    <span class="section-label">Part 3</span>
    <h2>Practice Quiz</h2>
    <p>Use the cues in each vignette or comparison to choose the best answer.</p>

    <form id="posttest-form">
      <!-- Post Q1 -->
      <div class="q-block">
        <strong>Question 1</strong>
        <p>
          Case E: For six months, Daniel has experienced persistent worry about academic deadlines, relationships, finances, and future plans.
          He reports being on edge most days, with muscle tension and restlessness. No trauma is mentioned.
        </p>
        <p>Which statement best uses the cues to classify Case E?</p>
        <div class="options">
          <label><input type="radio" name="post_q1" value="GAD_only" /> Case E is most consistent with Generalized Anxiety Disorder.</label>
          <label><input type="radio" name="post_q1" value="PTSD_only" /> Case E is most consistent with Post-Traumatic Stress Disorder.</label>
          <label><input type="radio" name="post_q1" value="none" /> The description fits only Acute Stress Disorder.</label>
          <label><input type="radio" name="post_q1" value="all" /> The description fits all anxiety and trauma-related disorders equally.</label>
        </div>
      </div>

      <!-- Post Q2 -->
      <div class="q-block">
        <strong>Question 2</strong>
        <p>
          Ten days after witnessing a violent fight at a party, Jordan experiences intrusive memories, is easily startled,
          avoids social gatherings, and has difficulty sleeping. Symptoms significantly interfere with school.
        </p>
        <p>Which conclusion best uses the duration cue?</p>
        <div class="options">
          <label>
            <input type="radio" name="post_q2" value="ASD" />
            The short duration suggests Acute Stress Disorder is more likely than Post-Traumatic Stress Disorder.
          </label>
          <label>
            <input type="radio" name="post_q2" value="PTSD" />
            Symptoms must last at least six months for any diagnosis, so neither disorder fits.
          </label>
          <label>
            <input type="radio" name="post_q2" value="none" />
            Duration does not matter when distinguishing trauma-related disorders.
          </label>
          <label>
            <input type="radio" name="post_q2" value="all" />
            The case fits Generalized Anxiety Disorder only.
          </label>
        </div>
      </div>

      <!-- Post Q3 -->
      <div class="q-block">
        <strong>Question 3</strong>
        <p>
          Sara reports experiencing several sudden panic surges in the last month. They peak rapidly and occur unexpectedly.
          She now avoids traveling alone and frequently monitors her body for signs of another attack. No trauma is mentioned.
        </p>
        <p>Which diagnosis is most strongly supported by these cues?</p>
        <div class="options">
          <label><input type="radio" name="post_q3" value="Panic" /> Panic Disorder</label>
          <label><input type="radio" name="post_q3" value="ASD" /> Acute Stress Disorder</label>
          <label><input type="radio" name="post_q3" value="GAD" /> Generalized Anxiety Disorder</label>
          <label><input type="radio" name="post_q3" value="PTSD" /> Post-Traumatic Stress Disorder</label>
        </div>
      </div>

      <!-- Post Q4 -->
      <div class="q-block">
        <strong>Question 4</strong>
        <p>
          A month and a half after being trapped in a building during a fire, Emilia experiences repeated intrusive memories,
          avoids the building, has trouble sleeping, and feels constantly on edge. These symptoms interfere with school and relationships.
        </p>
        <p>Which conclusion best uses duration and functional impairment?</p>
        <div class="options">
          <label><input type="radio" name="post_q4" value="PTSD" /> The time frame and impairment make Post-Traumatic Stress Disorder most likely.</label>
          <label><input type="radio" name="post_q4" value="ASD" /> Symptoms fit only Acute Stress Disorder because they follow a trauma.</label>
          <label><input type="radio" name="post_q4" value="none" /> Functional impairment should not be considered in diagnosis.</label>
          <label><input type="radio" name="post_q4" value="all" /> The case must be Generalized Anxiety Disorder because it lasts more than a month.</label>
        </div>
      </div>

      <!-- Post Q5 -->
      <div class="q-block">
        <strong>Question 5</strong>
        <p>
          A case describes months of broad, uncontrollable worry about many everyday situations (school, health, friendships).
          No traumatic event is mentioned, and the case notes that functioning is moderately affected.
        </p>
        <p>Which disorders can you most strongly rule out first using the lack of a trauma cue?</p>
        <div class="options">
          <label><input type="radio" name="post_q5" value="rule_out_trauma_disorders" /> Post-Traumatic Stress Disorder and Acute Stress Disorder.</label>
          <label><input type="radio" name="post_q5" value="rule_out_GAD" /> Generalized Anxiety Disorder only.</label>
          <label><input type="radio" name="post_q5" value="none" /> Trauma history never helps rule out disorders.</label>
          <label><input type="radio" name="post_q5" value="all" /> All options must be ruled out first.</label>
        </div>
      </div>

      <button type="button" class="btn" id="submit-all-btn">Submit</button>
    </form>
    <p id="submit-status" class="small-note"></p>
  </section>

</div>

<script>
  const DATA_ENDPOINT = "https://script.google.com/macros/s/AKfycbxPzDgnDddCYiNI2UVS85MiT7fQ1rFT3hEuq31CeZQbcxTambqfPcmDrKfwQTSQzweF6g/exec";

  const state = {
    participantId: null,
    condition: null, // "baseline" or "special_sauce"
    pretest: {},
    instruction: {},
    posttest: {},
    scores: {},
    process: {
      c2_attempts: 0,
      c2_attempt_history: [],
      c3_hint_used: false, // placeholder
      table_view_count: 0
    },
    timing: {
      pre_start: null,
      pre_end: null,
      instruction_start: null,
      instruction_end: null,
      post_start: null,
      post_end: null
    },
    instB_c2_diag: null
  };

  const consentCheckbox = document.getElementById("consent");
  const pidInput = document.getElementById("pid");
  const startBtn = document.getElementById("start-btn");

  const welcomeSection = document.getElementById("welcome-section");
  const pretestSection = document.getElementById("pretest-section");
  const pretestNextBtn = document.getElementById("pretest-next-btn");

  const instBaselineSection = document.getElementById("instruction-baseline");
  const instBaselineNextBtn = document.getElementById("instruction-baseline-next-btn");
  const baselineCheckBtn = document.getElementById("baseline-check-btn");
  const baselineFeedbackDiv = document.getElementById("baseline-feedback");

  const instSpecialSection = document.getElementById("instruction-special");
  const instSpecialNextBtn = document.getElementById("instruction-special-next-btn");

  const posttestSection = document.getElementById("posttest-section");
  const submitAllBtn = document.getElementById("submit-all-btn");
  const submitStatus = document.getElementById("submit-status");

  const pretestForm = document.getElementById("pretest-form");
  const posttestForm = document.getElementById("posttest-form");
  const instBaselineForm = document.getElementById("instruction-baseline-form");
  const instSpecialForm = document.getElementById("instruction-special-form");

  const c2SubmitBtn = document.getElementById("c2-submit-btn");
  const c2FeedbackDiv = document.getElementById("c2-feedback");
  const c2SelfExBlock = document.getElementById("c2-selfex-block");
  const c2SelfExTextarea = document.getElementById("c2-selfex");
  const c2ReflectBtn = document.getElementById("c2-reflect-btn");
  const c2ExpertDiv = document.getElementById("c2-expert");

  const c3SubmitBtn = document.getElementById("c3-submit-btn");
  const c3FeedbackDiv = document.getElementById("c3-feedback");
  const c3SelfExBlock = document.getElementById("c3-selfex-block");
  const c3SelfExTextarea = document.getElementById("c3-selfex");
  const c3ReflectBtn = document.getElementById("c3-reflect-btn");
  const c3ExpertDiv = document.getElementById("c3-expert");

  const showTableBtn = document.getElementById("show-table-btn");
  const cueOverlay = document.getElementById("cue-table-overlay");
  const closeTableBtn = document.getElementById("close-table-btn");

  function updateStartButton() {
    startBtn.disabled = !consentCheckbox.checked;
  }
  consentCheckbox.addEventListener("change", updateStartButton);

  startBtn.addEventListener("click", () => {
    state.participantId = pidInput.value.trim() || null;
    state.condition = Math.random() < 0.5 ? "baseline" : "special_sauce";
    console.log("Assigned condition:", state.condition);
    state.timing.pre_start = new Date().toISOString();
    welcomeSection.classList.add("hidden");
    pretestSection.classList.remove("hidden");
  });

  function computePreScore(pre) {
    let score = 0;
    if (pre.pre_q1 === "GAD_only") score++;
    if (pre.pre_q2 === "ASD_PTSD") score++;
    if (pre.pre_q3 === "sudden_fear") score++;
    if (pre.pre_q4 === "impairment_matters") score++;
    if (pre.pre_q5 === "rule_out_trauma_disorders") score++;
    return score;
  }

  function computePostScore(post) {
    let score = 0;
    if (post.post_q1 === "GAD_only") score++;
    if (post.post_q2 === "ASD") score++;
    if (post.post_q3 === "Panic") score++;
    if (post.post_q4 === "PTSD") score++;
    if (post.post_q5 === "rule_out_trauma_disorders") score++;
    return score;
  }

  pretestNextBtn.addEventListener("click", () => {
    const formData = new FormData(pretestForm);
    state.pretest = Object.fromEntries(formData.entries());

    state.timing.pre_end = new Date().toISOString();
    state.timing.instruction_start = new Date().toISOString();

    pretestSection.classList.add("hidden");
    if (state.condition === "baseline") {
      instBaselineSection.classList.remove("hidden");
    } else {
      instSpecialSection.classList.remove("hidden");
    }
  });

  // Baseline practice: corrective feedback after checking all
  baselineCheckBtn.addEventListener("click", () => {
    const formData = new FormData(instBaselineForm);
    const answers = Object.fromEntries(formData.entries());

    const q1 = answers.instA_q1 || "";
    const q2 = answers.instA_q2 || "";
    const q3 = answers.instA_q3 || "";
    const q4 = answers.instA_q4 || "";

    if (!q1 || !q2 || !q3 || !q4) {
      baselineFeedbackDiv.textContent = "Please answer all four cases before checking.";
      baselineFeedbackDiv.classList.remove("hidden");
      baselineFeedbackDiv.classList.remove("correct", "incorrect");
      return;
    }

    let lines = [];
    function evalCase(label, given, correctLabel, correctValue) {
      if (given === correctValue) {
        lines.push(label + ": Correct.");
      } else {
        lines.push(label + ": Incorrect. Correct answer: " + correctLabel + ".");
      }
    }

    evalCase("Case A", q1, "Post-Traumatic Stress Disorder", "PTSD");
    evalCase("Case B", q2, "Panic Disorder", "Panic");
    evalCase("Case C", q3, "Generalized Anxiety Disorder", "GAD");
    evalCase("Case D", q4, "Acute Stress Disorder", "ASD");

    baselineFeedbackDiv.textContent = lines.join(" ");
    baselineFeedbackDiv.classList.remove("hidden");
    baselineFeedbackDiv.classList.remove("incorrect");
    baselineFeedbackDiv.classList.add("correct");
    instBaselineNextBtn.disabled = false;
  });

  instBaselineNextBtn.addEventListener("click", () => {
    const formData = new FormData(instBaselineForm);
    state.instruction = Object.fromEntries(formData.entries());

    state.timing.instruction_end = new Date().toISOString();
    state.timing.post_start = new Date().toISOString();

    instBaselineSection.classList.add("hidden");
    posttestSection.classList.remove("hidden");
  });

  // Special-sauce: cue table overlay tracking
  showTableBtn.addEventListener("click", () => {
    cueOverlay.classList.remove("hidden");
    state.process.table_view_count = (state.process.table_view_count || 0) + 1;
  });

  closeTableBtn.addEventListener("click", () => {
    cueOverlay.classList.add("hidden");
  });

  cueOverlay.addEventListener("click", (e) => {
    if (e.target === cueOverlay) {
      cueOverlay.classList.add("hidden");
    }
  });

  // Special-sauce Case 2
  let c2Attempts = 0;
  const c2Correct = "GAD";

  c2SubmitBtn.addEventListener("click", () => {
    const radios = document.querySelectorAll("input[name='instB_c2_diag']");
    let chosen = null;
    radios.forEach(r => { if (r.checked) chosen = r.value; });

    if (!chosen) {
      c2FeedbackDiv.textContent = "Please select an option before submitting.";
      c2FeedbackDiv.classList.remove("hidden");
      c2FeedbackDiv.classList.remove("correct", "incorrect");
      return;
    }

    c2Attempts += 1;
    state.process.c2_attempts = c2Attempts;
    state.process.c2_attempt_history.push(chosen);
    state.instB_c2_diag = chosen;

    if (chosen === c2Correct) {
      c2FeedbackDiv.textContent = "Correct. Now explain your reasoning below.";
      c2FeedbackDiv.classList.remove("hidden");
      c2FeedbackDiv.classList.remove("incorrect");
      c2FeedbackDiv.classList.add("correct");
      c2SelfExBlock.classList.remove("hidden");
      c2SubmitBtn.disabled = true;
    } else {
      c2FeedbackDiv.textContent = "That is not the best fit. Revisit the cues about duration, breadth of worry, and trauma.";
      c2FeedbackDiv.classList.remove("hidden");
      c2FeedbackDiv.classList.remove("correct");
      c2FeedbackDiv.classList.add("incorrect");
    }
  });

  c2ReflectBtn.addEventListener("click", () => {
    c2ExpertDiv.classList.remove("hidden");
    c2ReflectBtn.disabled = true;
  });

  // Special-sauce Case 3
  const c3Correct = "Panic";

  c3SubmitBtn.addEventListener("click", () => {
    const radios = document.querySelectorAll("input[name='instB_c3_diag']");
    let chosen = null;
    radios.forEach(r => { if (r.checked) chosen = r.value; });

    if (!chosen) {
      c3FeedbackDiv.textContent = "Please select an option before submitting.";
      c3FeedbackDiv.classList.remove("hidden");
      c3FeedbackDiv.classList.remove("correct", "incorrect");
      return;
    }

    if (chosen === c3Correct) {
      c3FeedbackDiv.textContent = "Correct. Now describe what cues led you there.";
      c3FeedbackDiv.classList.remove("hidden");
      c3FeedbackDiv.classList.remove("incorrect");
      c3FeedbackDiv.classList.add("correct");
      c3SelfExBlock.classList.remove("hidden");
      c3SubmitBtn.disabled = true;
    } else {
      c3FeedbackDiv.textContent = "That is not the best fit. Think carefully about the pattern of sudden onset and ongoing fear of future episodes.";
      c3FeedbackDiv.classList.remove("hidden");
      c3FeedbackDiv.classList.remove("correct");
      c3FeedbackDiv.classList.add("incorrect");
    }
  });

  c3ReflectBtn.addEventListener("click", () => {
    c3ExpertDiv.classList.remove("hidden");
    c3ReflectBtn.disabled = true;
  });

  instSpecialNextBtn.addEventListener("click", () => {
    const formData = new FormData(instSpecialForm);
    const instAnswers = Object.fromEntries(formData.entries());
    instAnswers.c2_diag_attempt = state.instB_c2_diag || null;
    instAnswers.c2_self_explanation = c2SelfExTextarea.value || "";
    instAnswers.c3_self_explanation = c3SelfExTextarea.value || "";
    state.instruction = instAnswers;

    state.timing.instruction_end = new Date().toISOString();
    state.timing.post_start = new Date().toISOString();

    instSpecialSection.classList.add("hidden");
    posttestSection.classList.remove("hidden");
  });

  submitAllBtn.addEventListener("click", async () => {
    const formData = new FormData(posttestForm);
    state.posttest = Object.fromEntries(formData.entries());
    state.timing.post_end = new Date().toISOString();

    const preScore = computePreScore(state.pretest);
    const postScore = computePostScore(state.posttest);
    state.scores = {
      pre_mcq: preScore,
      post_mcq: postScore,
      gain_mcq: postScore - preScore
    };

    const payload = {
      timestamp: new Date().toISOString(),
      participantId: state.participantId,
      condition: state.condition,
      pretest: state.pretest,
      instruction: state.instruction,
      posttest: state.posttest,
      scores: state.scores,
      process: state.process,
      timing: state.timing
    };

    console.log("Submitting payload:", payload);
    submitStatus.textContent = "Submitting...";
    submitAllBtn.disabled = true;

    try {
      await fetch(DATA_ENDPOINT, {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "text/plain"
        },
        body: JSON.stringify(payload)
      });

      submitStatus.textContent =
        "Thank you. Your responses have been submitted. You can now close this page.";
    } catch (err) {
      console.error("Network error during submit:", err);
      submitStatus.textContent =
        "There was a network error while submitting. Please screenshot this page and let the instructor know.";
      submitAllBtn.disabled = false;
    }
  });
</script>

</body>
</html>
