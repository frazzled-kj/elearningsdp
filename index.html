<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AP Psych – Anxiety & Trauma Disorders Lesson</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #f7f7fb;
      color: #222;
    }

    .app-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    h1, h2, h3 {
      margin-top: 0;
    }

    .card {
      background: #fff;
      border-radius: 10px;
      padding: 20px 22px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      margin-bottom: 18px;
    }

    .hidden {
      display: none;
    }

    button {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      background: #1f6feb;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      margin-top: 10px;
    }

    button.secondary {
      background: #e0e4f4;
      color: #111;
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .question {
      margin-bottom: 16px;
    }

    .question p {
      margin: 0 0 6px 0;
    }

    .options label {
      display: block;
      margin-bottom: 4px;
      cursor: pointer;
    }

    .nav-buttons {
      margin-top: 16px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .error {
      color: #b00020;
      margin-top: 8px;
      font-size: 0.9rem;
    }

    .feedback {
      font-size: 0.9rem;
      margin-top: 6px;
    }

    .feedback.correct {
      color: #0b7a2a;
    }

    .feedback.incorrect {
      color: #b00020;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      font-family: inherit;
      font-size: 0.95rem;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      resize: vertical;
    }

    .vignette {
      background: #f5f7ff;
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 8px;
      border: 1px solid #e1e4ff;
      font-size: 0.95rem;
    }

    .highlight {
      font-weight: 600;
    }

    .small-note {
      font-size: 0.85rem;
      color: #555;
      margin-top: 4px;
    }

    .cue-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: 6px;
    }

    .cue-table th,
    .cue-table td {
      border: 1px solid #d1d5db;
      padding: 6px 8px;
      vertical-align: top;
    }

    .cue-table th {
      background: #edf2ff;
      text-align: left;
    }

    .inline-btn {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #e5ecff;
      color: #11327b;
      border: none;
      cursor: pointer;
    }

    .view-table-row {
      text-align: right;
      margin-top: 4px;
      margin-bottom: 8px;
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal {
      background: #fff;
      max-width: 720px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      border-radius: 10px;
      padding: 16px 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .modal-header h3 {
      margin: 0;
    }

    .linkish {
      color: #1f6feb;
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .template-box {
      background: #f8fafc;
      border-radius: 8px;
      padding: 8px 10px;
      border: 1px dashed #cbd5f5;
      font-size: 0.9rem;
      margin-top: 4px;
    }
  </style>
</head>
<body>
<div class="app-container">
  <!-- WELCOME -->
  <div id="welcomeScreen" class="card">
    <h1>AP Psychology: Anxiety & Trauma-Related Disorders</h1>
    <p>In this short module, you will:</p>
    <ul>
      <li>Take a quick case-based quiz (pre-test).</li>
      <li>Work through a short online lesson on Generalized Anxiety Disorder, Panic Disorder, and PTSD.</li>
      <li>Take a similar case-based quiz again (post-test).</li>
    </ul>
    <p>This will take about 12–18 minutes.</p>
    <button id="startBtn">Start</button>
  </div>

  <!-- PRE-TEST -->
  <div id="pretestScreen" class="card hidden">
    <h2>Pre-Quiz: Case-Based Diagnosis</h2>
    <p>For each vignette, choose the diagnosis that best fits the description.</p>

    <div class="question">
      <p><strong>Pre Q1.</strong> Alex has spent the last six months feeling tense and “on edge” most days. They worry about school, health, and their family even when nothing obvious is wrong. They have trouble sleeping, feel fatigued, and find it hard to concentrate. The worry feels excessive and difficult to control.</p>
      <div class="options">
        <label><input type="radio" name="pre_q1" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q1" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q1" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q1" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q2.</strong> Sam experiences sudden surges of intense fear that peak within minutes. During these episodes, Sam’s heart races, they feel short of breath, dizzy, and worry they might be “going crazy” or dying. The attacks are unexpected, and now Sam fears having more in public places.</p>
      <div class="options">
        <label><input type="radio" name="pre_q2" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q2" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q2" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q2" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q3.</strong> A year after surviving a serious car accident, Maya still has frequent nightmares about the crash, avoids driving or even getting into cars, and feels jumpy when she hears screeching tires. She sometimes feels like she is back in the car again and has difficulty sleeping.</p>
      <div class="options">
        <label><input type="radio" name="pre_q3" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q3" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q3" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q3" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q4.</strong> Jordan often feels restless and keyed up, but their main difficulty is brief, intense episodes of fear with chest pain and a sense of losing control that seem to come “out of the blue.” Between episodes, Jordan worries a lot about having another attack and avoids places where escape would be hard.</p>
      <div class="options">
        <label><input type="radio" name="pre_q4" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q4" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q4" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q4" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Pre Q5.</strong> For the past eight months, Lina has worried “about everything” most days, including grades, friendships, and the future. The worries feel difficult to shut off, and she notices muscle tension and poor sleep. There is no single specific trauma that triggered this pattern.</p>
      <div class="options">
        <label><input type="radio" name="pre_q5" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="pre_q5" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="pre_q5" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="pre_q5" value="None"> None of these</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="preSubmit">Submit pre-quiz</button>
    </div>
    <div id="preError" class="error"></div>
  </div>

  <!-- BASELINE INSTRUCTION: typical unit -->
  <div id="baselineInstruction" class="card hidden">
    <h2>Lesson: Anxiety & Trauma-Related Disorders (Text-Based)</h2>

    <p>
      This lesson introduces three disorders that often appear in AP Psychology units on anxiety and trauma:
      <strong>Generalized Anxiety Disorder (GAD)</strong>, <strong>Panic Disorder</strong>, and
      <strong>Posttraumatic Stress Disorder (PTSD)</strong>. Each diagnosis involves characteristic symptom patterns
      and clear functional impairment in daily life.
    </p>

    <h3>Generalized Anxiety Disorder (GAD)</h3>
    <p>
      GAD involves excessive, hard-to-control worry about multiple domains (school, work, health, family) on more days
      than not for at least six months. People with GAD often experience restlessness, fatigue, difficulty concentrating,
      irritability, muscle tension, and sleep disturbance. The anxiety causes significant distress or problems
      functioning at school, work, or in relationships.
    </p>

    <h3>Panic Disorder</h3>
    <p>
      Panic Disorder is defined by recurrent, unexpected panic attacks. A panic attack is a sudden surge of intense fear
      or discomfort that peaks within minutes and includes physical symptoms (e.g., heart palpitations, sweating,
      trembling, shortness of breath, chest pain, dizziness) and fears of losing control, “going crazy,” or dying. At
      least one attack is followed by a month or more of persistent concern about additional attacks and/or maladaptive
      changes in behavior (such as avoiding exercise or public places). Symptoms interfere with everyday life.
    </p>

    <h3>Posttraumatic Stress Disorder (PTSD)</h3>
    <p>
      PTSD follows exposure to a traumatic event involving actual or threatened serious injury, sexual violence, or death.
      Core features include intrusive memories or flashbacks, avoidance of reminders, negative changes in mood and
      thinking, and changes in arousal (e.g., being jumpy, irritable, or hyper-vigilant). Symptoms last more than one
      month and lead to clinically significant distress or impairment in functioning.
    </p>

    <h3>Review Questions (Baseline)</h3>
    <p>These questions check comprehension of basic definitions and symptom patterns. They give right/wrong feedback only.</p>

    <div class="question">
      <p><strong>Practice B1.</strong> Which diagnosis most clearly requires exposure to a traumatic event as part of the criteria?</p>
      <div class="options">
        <label><input type="radio" name="base_p1" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="base_p1" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_p1" value="Panic"> Panic Disorder</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Practice B2.</strong> Which diagnosis is most closely associated with recurrent, unexpected surges of intense fear that peak within minutes?</p>
      <div class="options">
        <label><input type="radio" name="base_p2" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="base_p2" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_p2" value="PTSD"> Posttraumatic Stress Disorder</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Practice B3.</strong> Which pattern best matches GAD rather than PTSD or Panic Disorder?</p>
      <div class="options">
        <label><input type="radio" name="base_p3" value="GAD"> Long-term, diffuse worry across many domains without a single trauma</label>
        <label><input type="radio" name="base_p3" value="Panic"> Brief, intense episodes of fear with physical symptoms</label>
        <label><input type="radio" name="base_p3" value="PTSD"> Intrusions and avoidance following a traumatic event</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Practice B4.</strong> A student who has occasional, short-lived worry before tests that does not interfere with daily life most likely:</p>
      <div class="options">
        <label><input type="radio" name="base_p4" value="None"> Does not meet criteria for any of these disorders</label>
        <label><input type="radio" name="base_p4" value="GAD"> Meets criteria for Generalized Anxiety Disorder</label>
        <label><input type="radio" name="base_p4" value="Panic"> Meets criteria for Panic Disorder</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="baselineCheck">Check answers</button>
      <button id="baselineNext" disabled>Continue to post-quiz</button>
    </div>
    <div id="baselineFeedback" class="feedback"></div>
  </div>

  <!-- SPECIAL-SAUCE INSTRUCTION: metacognitive cycle + fading -->
  <div id="guidedInstruction" class="card hidden">
    <h2>Guided Lesson: Using Diagnostic Cues</h2>
    <p>
      This version focuses on learning by doing, immediate corrective feedback, and short metacognitive reflections
      about which cues you used.
    </p>

    <h3>Segmented Cue Overview</h3>
    <p class="small-note">Scan the main cues. You can reopen this cue table while working on the cases.</p>
    <table class="cue-table">
      <thead>
      <tr>
        <th>Disorder</th>
        <th>Core cues</th>
        <th>Functional impairment examples</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td><strong>Generalized Anxiety Disorder (GAD)</strong></td>
        <td>
          &bull; Excessive, hard-to-control worry about multiple domains<br>
          &bull; Symptoms &gt; 6 months<br>
          &bull; Restlessness, fatigue, poor concentration, muscle tension, poor sleep
        </td>
        <td>
          &bull; Declining grades due to constant worry<br>
          &bull; Difficulty relaxing enough to spend time with friends<br>
          &bull; Sleep disruption affecting daily functioning
        </td>
      </tr>
      <tr>
        <td><strong>Panic Disorder</strong></td>
        <td>
          &bull; Recurrent, unexpected panic attacks<br>
          &bull; Sudden surges of intense fear peaking within minutes<br>
          &bull; Physical symptoms (heart racing, shortness of breath, chest pain, dizziness)<br>
          &bull; Persistent concern about more attacks, avoidance of triggers
        </td>
        <td>
          &bull; Avoiding exercise or crowded places for fear of attacks<br>
          &bull; Missing school or work to avoid potential attacks
        </td>
      </tr>
      <tr>
        <td><strong>Posttraumatic Stress Disorder (PTSD)</strong></td>
        <td>
          &bull; Clear traumatic event involving serious injury, violence, or threat<br>
          &bull; Intrusions (flashbacks, nightmares)<br>
          &bull; Avoidance of reminders<br>
          &bull; Negative mood/cognition changes<br>
          &bull; Hyperarousal (jumpy, on guard)
        </td>
        <td>
          &bull; Avoiding places or people linked to the trauma<br>
          &bull; Difficulty sleeping or concentrating at school<br>
          &bull; Withdrawal from relationships
        </td>
      </tr>
      </tbody>
    </table>

    <div class="small-note">You can reopen this table from any case using “View cue table.”</div>

    <!-- Modal cue table -->
    <div id="tableModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h3>Diagnostic Cue Table</h3>
          <span id="closeTableModal" class="linkish">Close</span>
        </div>
        <table class="cue-table">
          <thead>
          <tr>
            <th>Disorder</th>
            <th>Core cues</th>
            <th>Functional impairment examples</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td><strong>Generalized Anxiety Disorder (GAD)</strong></td>
            <td>
              &bull; Excessive, hard-to-control worry about multiple domains<br>
              &bull; Symptoms &gt; 6 months<br>
              &bull; Restlessness, fatigue, poor concentration, muscle tension, poor sleep
            </td>
            <td>
              &bull; Declining grades due to constant worry<br>
              &bull; Difficulty relaxing enough to spend time with friends<br>
              &bull; Sleep disruption affecting daily functioning
            </td>
          </tr>
          <tr>
            <td><strong>Panic Disorder</strong></td>
            <td>
              &bull; Recurrent, unexpected panic attacks<br>
              &bull; Sudden surges of intense fear peaking within minutes<br>
              &bull; Physical symptoms (heart racing, shortness of breath, chest pain, dizziness)<br>
              &bull; Persistent concern about more attacks, avoidance of triggers
            </td>
            <td>
              &bull; Avoiding exercise or crowded places for fear of attacks<br>
              &bull; Missing school or work to avoid potential attacks
            </td>
          </tr>
          <tr>
            <td><strong>Posttraumatic Stress Disorder (PTSD)</strong></td>
            <td>
              &bull; Clear traumatic event involving serious injury, violence, or threat<br>
              &bull; Intrusions (flashbacks, nightmares)<br>
              &bull; Avoidance of reminders<br>
              &bull; Negative mood/cognition changes<br>
              &bull; Hyperarousal (jumpy, on guard)
            </td>
            <td>
              &bull; Avoiding places or people linked to the trauma<br>
              &bull; Difficulty sleeping or concentrating at school<br>
              &bull; Withdrawal from relationships
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- CASE 1: Full annotated, extraction + inference + diagnosis + self-explanation -->
    <h3>Case 1 – Annotated Worked Example</h3>
    <div class="view-table-row">
      <button type="button" class="inline-btn" data-view-table>View cue table</button>
    </div>
    <div class="vignette">
      <strong>Case 1.</strong> Taylor frequently has nightmares about a <span class="highlight">severe storm that destroyed their home</span>.
      Taylor <span class="highlight">avoids news about storms</span>, feels <span class="highlight">detached from friends</span>, and
      startles easily when thunder rumbles. Symptoms began soon after the disaster and have <span class="highlight">persisted for over a year</span>,
      interfering with <span class="highlight">school attendance and social life</span>.
      <ul>
        <li><span class="highlight">Triggering event:</span> severe storm destroying home (trauma).</li>
        <li><span class="highlight">Timeline:</span> symptoms persisting &gt; 1 year.</li>
        <li><span class="highlight">Symptom cluster:</span> nightmares, avoidance, detachment, hyperarousal.</li>
        <li><span class="highlight">Functional impairment:</span> school and social life affected.</li>
      </ul>
    </div>

    <p><strong>Direct extraction questions</strong></p>
    <div class="question">
      <p>1. How long have Taylor’s symptoms lasted?</p>
      <input type="text" id="c1_extract1" placeholder="e.g., more than a year">
    </div>
    <div class="question">
      <p>2. Does the vignette mention a triggering event? If yes, what is it?</p>
      <input type="text" id="c1_extract2" placeholder="Describe the event">
    </div>
    <div class="question">
      <p>3. Which phrase indicates functional impairment?</p>
      <input type="text" id="c1_extract3" placeholder="Quote or paraphrase the phrase">
    </div>

    <p><strong>Inference questions</strong></p>
    <div class="question">
      <p>4. Given the timeline, which diagnosis is least likely?</p>
      <div class="options">
        <label><input type="radio" name="c1_inf1" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="c1_inf1" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="c1_inf1" value="GAD"> Generalized Anxiety Disorder</label>
      </div>
    </div>
    <div class="question">
      <p>5. Does the presence of a clear trauma strengthen the case for PTSD?</p>
      <div class="options">
        <label><input type="radio" name="c1_inf2" value="Yes"> Yes</label>
        <label><input type="radio" name="c1_inf2" value="No"> No</label>
      </div>
    </div>

    <p><strong>Prediction attempt</strong></p>
    <div class="question">
      <p>Before choosing, identify at least one cue that supports your answer.</p>
      <input type="text" id="c1_gate" placeholder="Write at least one cue...">
      <div class="template-box">
        Template: “I think this is &lt;diagnosis&gt; because of &lt;cue(s)&gt;.”
      </div>
    </div>

    <div class="question">
      <p>6. Based on the cues, what is the most appropriate diagnosis?</p>
      <div class="options">
        <label><input type="radio" name="g1_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="g1_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="g1_diag" value="Panic"> Panic Disorder</label>
      </div>
      <button type="button" id="g1Check">Check diagnosis</button>
      <div id="g1Feedback" class="feedback"></div>
    </div>

    <div id="g1ReflectionBlock" class="hidden">
      <p><strong>Self-explanation:</strong> Briefly explain the cues you used to identify this diagnosis.</p>
      <textarea id="g1Reflection"></textarea>
      <button type="button" id="g1SubmitReflection">Submit reflection</button>
      <div id="g1ReflectionFeedback" class="feedback"></div>
    </div>

    <div id="g1ExpertBlock" class="hidden small-note">
      <p><strong>Expert reasoning (Case 1):</strong> The clear traumatic event, long duration of intrusions
        (nightmares), avoidance, withdrawal, hyperarousal, and functional impairment over a year fit Posttraumatic Stress Disorder.</p>
      <p><strong>Cue map for this case:</strong></p>
      <ul>
        <li>Trauma present? → Yes → PTSD more likely.</li>
        <li>Symptom duration &gt; 1 month? → Yes → PTSD vs acute stress.</li>
        <li>Intrusions + avoidance + hyperarousal + impairment → strongly support PTSD.</li>
      </ul>
      <p><strong>One-sentence takeaway:</strong> PTSD requires exposure to trauma plus intrusions, avoidance,
        and functional impairment lasting more than one month.</p>
    </div>

    <!-- CASE 2: partial cues + hint + metacognitive cycle -->
    <h3>Case 2 – Guided Practice with Hints</h3>
    <div class="view-table-row">
      <button type="button" class="inline-btn" data-view-table>View cue table</button>
      <button type="button" class="inline-btn" id="c2HintBtn">Show hint</button>
    </div>
    <div class="vignette">
      <strong>Case 2.</strong> Jordan often feels restless and “keyed up,” but their most distressing experiences are brief surges of intense fear that
      peak within minutes. During these episodes Jordan’s heart races, breathing feels difficult, and they worry they
      might be “going crazy” or dying. The episodes are unexpected, and in between Jordan spends weeks worrying about
      having another attack and avoids crowded buses where escape might be hard.
    </div>
    <div id="c2HintText" class="small-note hidden">
      Hint: Pay attention to the sudden, time-limited attacks and the ongoing worry about future episodes.
    </div>

    <div class="question">
      <p>Before choosing, identify at least one cue that supports your answer.</p>
      <input type="text" id="c2_gate" placeholder="Write at least one cue...">
      <div class="template-box">
        Template: “I think this is &lt;diagnosis&gt; because of &lt;cue(s)&gt;.”
      </div>
    </div>

    <div class="question">
      <p>7. What diagnosis best fits Case 2?</p>
      <div class="options">
        <label><input type="radio" name="g2_diag" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="g2_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="g2_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="g2_diag" value="None"> None of these</label>
      </div>
      <button type="button" id="g2Check">Check diagnosis</button>
      <div id="g2Feedback" class="feedback"></div>
    </div>

    <div id="g2ReflectionBlock" class="hidden">
      <p><strong>Self-explanation:</strong> Briefly explain the cues you used to identify this diagnosis.</p>
      <textarea id="g2Reflection"></textarea>
      <button type="button" id="g2SubmitReflection">Submit reflection</button>
      <div id="g2ReflectionFeedback" class="feedback"></div>
    </div>

    <div id="g2ExpertBlock" class="hidden small-note">
      <p><strong>Expert reasoning (Case 2):</strong> This pattern fits Panic Disorder: recurrent, unexpected panic attacks
        with intense physical symptoms, followed by persistent worry and avoidance that impair daily life.</p>
    </div>

    <!-- CASE 3: faded scaffolding + hint -->
    <h3>Case 3 – Less Scaffolded Practice</h3>
    <div class="view-table-row">
      <button type="button" class="inline-btn" data-view-table>View cue table</button>
      <button type="button" class="inline-btn" id="c3HintBtn">Show hint</button>
    </div>
    <div class="vignette">
      <strong>Case 3.</strong> For the past eight months, Lina has worried “about everything” most days, including grades,
      friendships, and the future. The worries feel difficult to shut off, and Lina notices muscle tension and poor sleep.
      There is no single specific trauma that triggered this pattern, but the constant worry has made it harder to keep
      up with schoolwork and enjoy time with friends.
    </div>
    <div id="c3HintText" class="small-note hidden">
      Hint: Focus on duration, breadth of worry, physical symptoms, and functional impairment. Is there a trauma or sudden attack?
    </div>

    <div class="question">
      <p>Before choosing, identify at least one cue that supports your answer.</p>
      <input type="text" id="c3_gate" placeholder="Write at least one cue...">
      <div class="template-box">
        Template: “I think this is &lt;diagnosis&gt; because of &lt;cue(s)&gt;.”
      </div>
    </div>

    <div class="question">
      <p>8. What diagnosis best fits Case 3?</p>
      <div class="options">
        <label><input type="radio" name="g3_diag" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="g3_diag" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="g3_diag" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="g3_diag" value="None"> None of these</label>
      </div>
      <button type="button" id="g3Check">Check diagnosis</button>
      <div id="g3Feedback" class="feedback"></div>
    </div>

    <div id="g3ReflectionBlock" class="hidden">
      <p><strong>Self-explanation:</strong> Briefly explain the cues you used to identify this diagnosis.</p>
      <textarea id="g3Reflection"></textarea>
      <button type="button" id="g3SubmitReflection">Submit reflection</button>
      <div id="g3ReflectionFeedback" class="feedback"></div>
    </div>

    <div id="g3ExpertBlock" class="hidden small-note">
      <p><strong>Expert reasoning (Case 3):</strong> The long duration of excessive, hard-to-control worry across many
        domains, combined with physical symptoms and functional impairment, fits Generalized Anxiety Disorder rather than
        a trauma- or attack-based diagnosis.</p>
    </div>

    <div class="nav-buttons">
      <button id="guidedNext">Continue to post-quiz</button>
    </div>
  </div>

  <!-- POST-TEST -->
  <div id="posttestScreen" class="card hidden">
    <h2>Post-Quiz: Case-Based Diagnosis</h2>
    <p>Same style as the pre-quiz. Choose the diagnosis that best fits each vignette.</p>

    <div class="question">
      <p><strong>Post Q1.</strong> A year after surviving a serious car accident, Maya still has frequent nightmares about
        the crash, avoids driving, and feels jumpy when hearing screeching brakes. She sometimes feels like she is back in
        the car again and is missing classes because of avoidance.</p>
      <div class="options">
        <label><input type="radio" name="post_q1" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q1" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q1" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q1" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q2.</strong> Alex has spent the last six months feeling tense and “on edge” most days. They worry
        about school, health, and their family even when nothing obvious is wrong. They have trouble sleeping, feel
        fatigued, and find it hard to concentrate. The worry feels excessive and difficult to control.</p>
      <div class="options">
        <label><input type="radio" name="post_q2" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q2" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q2" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q2" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q3.</strong> Sam experiences sudden surges of intense fear that peak within minutes. During these
        episodes, Sam’s heart races, they feel short of breath, dizzy, and worry they might be “going crazy” or dying.
        The attacks are unexpected, and now Sam fears having more in public places.</p>
      <div class="options">
        <label><input type="radio" name="post_q3" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q3" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q3" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q3" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q4.</strong> For the past eight months, Lina has worried “about everything” most days, including
        grades, friendships, and the future. The worries feel difficult to shut off, and she notices muscle tension and
        poor sleep. The worry has started to interfere with schoolwork.</p>
      <div class="options">
        <label><input type="radio" name="post_q4" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q4" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q4" value="PTSD"> Posttraumatic Stress Disorder</label>
        <label><input type="radio" name="post_q4" value="None"> None of these</label>
      </div>
    </div>

    <div class="question">
      <p><strong>Post Q5.</strong> Devon worries intensely for a week before major exams and has some trouble sleeping
        during that week, but otherwise feels fine and functions well in daily life. The worries are tied to specific
        deadlines and resolve afterward.</p>
      <div class="options">
        <label><input type="radio" name="post_q5" value="None"> None of these</label>
        <label><input type="radio" name="post_q5" value="GAD"> Generalized Anxiety Disorder</label>
        <label><input type="radio" name="post_q5" value="Panic"> Panic Disorder</label>
        <label><input type="radio" name="post_q5" value="PTSD"> Posttraumatic Stress Disorder</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="postSubmit">Submit post-quiz</button>
    </div>
    <div id="postError" class="error"></div>
    <div id="submitStatus" class="feedback"></div>
  </div>

  <!-- FINAL -->
  <div id="finalScreen" class="card hidden">
    <h2>Thank you!</h2>
    <p>Your responses have been recorded.</p>
  </div>
</div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxPzDgnDddCYiNI2UVS85MiT7fQ1rFT3hEuq31CeZQbcxTambqfPcmDrKfwQTSQzweF6g/exec";

  // State
  let condition = null; // "baseline" or "special_sauce"
  let preStartTime = null;
  let preEndTime = null;
  let instructionStartTime = null;
  let instructionEndTime = null;
  let postStartTime = null;
  let postEndTime = null;

  let preAnswers = {};
  let postAnswers = {};
  let tableViewCount = 0;

  function showScreen(id) {
    ["welcomeScreen","pretestScreen","baselineInstruction","guidedInstruction","posttestScreen","finalScreen"]
      .forEach(s => document.getElementById(s).classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
  }

  function getSelectedValue(name) {
    const radios = document.querySelectorAll(`input[name="${name}"]`);
    for (const r of radios) {
      if (r.checked) return r.value;
    }
    return "";
  }

  function computePreScore() {
    const key = {
      pre_q1: "GAD",
      pre_q2: "Panic",
      pre_q3: "PTSD",
      pre_q4: "Panic",
      pre_q5: "GAD"
    };
    let score = 0;
    Object.keys(key).forEach(q => {
      if (preAnswers[q] === key[q]) score++;
    });
    return score;
  }

  function computePostScore() {
    const key = {
      post_q1: "PTSD",
      post_q2: "GAD",
      post_q3: "Panic",
      post_q4: "GAD",
      post_q5: "None"
    };
    let score = 0;
    Object.keys(key).forEach(q => {
      if (postAnswers[q] === key[q]) score++;
    });
    return score;
  }

  // Event wiring
  document.getElementById("startBtn").addEventListener("click", () => {
    preStartTime = Date.now();
    showScreen("pretestScreen");
  });

  document.getElementById("preSubmit").addEventListener("click", () => {
    const errEl = document.getElementById("preError");
    errEl.textContent = "";
    const qNames = ["pre_q1","pre_q2","pre_q3","pre_q4","pre_q5"];
    for (const q of qNames) {
      const v = getSelectedValue(q);
      if (!v) {
        errEl.textContent = "Please answer all questions before continuing.";
        return;
      }
      preAnswers[q] = v;
    }
    preEndTime = Date.now();

    // Randomly assign condition
    condition = Math.random() < 0.5 ? "baseline" : "special_sauce";
    instructionStartTime = Date.now();
    if (condition === "baseline") {
      showScreen("baselineInstruction");
    } else {
      showScreen("guidedInstruction");
    }
  });

  // Baseline: simple right/wrong check
  document.getElementById("baselineCheck").addEventListener("click", () => {
    const fb = document.getElementById("baselineFeedback");
    fb.classList.remove("correct","incorrect");

    const answers = {
      base_p1: "PTSD",
      base_p2: "Panic",
      base_p3: "GAD",
      base_p4: "None"
    };
    let allAnswered = true;
    let correctCount = 0;
    Object.keys(answers).forEach(name => {
      const v = getSelectedValue(name);
      if (!v) allAnswered = false;
      if (v === answers[name]) correctCount++;
    });
    if (!allAnswered) {
      fb.textContent = "Please answer all review questions before checking.";
      fb.classList.add("incorrect");
      return;
    }
    fb.textContent = `You got ${correctCount} out of 4 questions correct. When you are ready, continue to the post-quiz.`;
    fb.classList.add("correct");
    document.getElementById("baselineNext").disabled = false;
  });

  document.getElementById("baselineNext").addEventListener("click", () => {
    instructionEndTime = Date.now();
    postStartTime = Date.now();
    showScreen("posttestScreen");
  });

  // Cue table modal + counting
  document.querySelectorAll("[data-view-table]").forEach(btn => {
    btn.addEventListener("click", () => {
      tableViewCount++;
      document.getElementById("tableModal").style.display = "flex";
    });
  });
  document.getElementById("closeTableModal").addEventListener("click", () => {
    document.getElementById("tableModal").style.display = "none";
  });

  // Case 1 diagnosis & self-explain
  document.getElementById("g1Check").addEventListener("click", () => {
    const fb = document.getElementById("g1Feedback");
    fb.classList.remove("correct","incorrect");
    const gate = document.getElementById("c1_gate").value.trim();
    if (!gate) {
      fb.textContent = "Before checking, identify at least one cue that supports your answer.";
      fb.classList.add("incorrect");
      return;
    }
    const v = getSelectedValue("g1_diag");
    if (!v) {
      fb.textContent = "Please select a diagnosis first.";
      fb.classList.add("incorrect");
      return;
    }
    if (v === "PTSD") {
      fb.textContent = "Correct. The trauma, long duration, intrusions, avoidance, and impairment fit PTSD.";
      fb.classList.add("correct");
      document.getElementById("g1ReflectionBlock").classList.remove("hidden");
    } else {
      fb.textContent = "Not quite. Focus on the clear trauma plus long-lasting intrusions, avoidance, and functional impairment.";
      fb.classList.add("incorrect");
    }
  });

  document.getElementById("g1SubmitReflection").addEventListener("click", () => {
    const txt = document.getElementById("g1Reflection").value.trim();
    const fb = document.getElementById("g1ReflectionFeedback");
    fb.classList.remove("correct","incorrect");
    if (!txt) {
      fb.textContent = "Please briefly explain the cues you used.";
      fb.classList.add("incorrect");
      return;
    }
    fb.textContent = "Reflection submitted. Compare your reasoning with the expert explanation below.";
    fb.classList.add("correct");
    document.getElementById("g1ExpertBlock").classList.remove("hidden");
  });

  // Case 2 hint
  document.getElementById("c2HintBtn").addEventListener("click", () => {
    document.getElementById("c2HintText").classList.remove("hidden");
  });

  // Case 3 hint
  document.getElementById("c3HintBtn").addEventListener("click", () => {
    document.getElementById("c3HintText").classList.remove("hidden");
  });

  // Case 2 metacognitive cycle
  document.getElementById("g2Check").addEventListener("click", () => {
    const fb = document.getElementById("g2Feedback");
    fb.classList.remove("correct","incorrect");
    const gate = document.getElementById("c2_gate").value.trim();
    if (!gate) {
      fb.textContent = "Before checking, identify at least one cue that supports your answer.";
      fb.classList.add("incorrect");
      return;
    }
    const v = getSelectedValue("g2_diag");
    if (!v) {
      fb.textContent = "Please select a diagnosis first.";
      fb.classList.add("incorrect");
      return;
    }
    if (v === "Panic") {
      fb.textContent = "Correct. Sudden, intense attacks with physical symptoms plus ongoing worry and avoidance fit Panic Disorder.";
      fb.classList.add("correct");
      document.getElementById("g2ReflectionBlock").classList.remove("hidden");
    } else {
      fb.textContent = "Not quite. Notice the brief, time-limited surges of fear and the persistent worry about future attacks.";
      fb.classList.add("incorrect");
    }
  });

  document.getElementById("g2SubmitReflection").addEventListener("click", () => {
    const txt = document.getElementById("g2Reflection").value.trim();
    const fb = document.getElementById("g2ReflectionFeedback");
    fb.classList.remove("correct","incorrect");
    if (!txt) {
      fb.textContent = "Please briefly explain the cues you used.";
      fb.classList.add("incorrect");
      return;
    }
    fb.textContent = "Reflection submitted. Compare your reasoning with the expert explanation below.";
    fb.classList.add("correct");
    document.getElementById("g2ExpertBlock").classList.remove("hidden");
  });

  // Case 3 metacognitive cycle
  document.getElementById("g3Check").addEventListener("click", () => {
    const fb = document.getElementById("g3Feedback");
    fb.classList.remove("correct","incorrect");
    const gate = document.getElementById("c3_gate").value.trim();
    if (!gate) {
      fb.textContent = "Before checking, identify at least one cue that supports your answer.";
      fb.classList.add("incorrect");
      return;
    }
    const v = getSelectedValue("g3_diag");
    if (!v) {
      fb.textContent = "Please select a diagnosis first.";
      fb.classList.add("incorrect");
      return;
    }
    if (v === "GAD") {
      fb.textContent = "Correct. Chronic, diffuse worry across many domains with physical symptoms and impairment fits GAD.";
      fb.classList.add("correct");
      document.getElementById("g3ReflectionBlock").classList.remove("hidden");
    } else {
      fb.textContent = "Not quite. Focus on the long duration, breadth of worry, and lack of a clear trauma or sudden attacks.";
      fb.classList.add("incorrect");
    }
  });

  document.getElementById("g3SubmitReflection").addEventListener("click", () => {
    const txt = document.getElementById("g3Reflection").value.trim();
    const fb = document.getElementById("g3ReflectionFeedback");
    fb.classList.remove("correct","incorrect");
    if (!txt) {
      fb.textContent = "Please briefly explain the cues you used.";
      fb.classList.add("incorrect");
      return;
    }
    fb.textContent = "Reflection submitted. Compare your reasoning with the expert explanation below.";
    fb.classList.add("correct");
    document.getElementById("g3ExpertBlock").classList.remove("hidden");
  });

  document.getElementById("guidedNext").addEventListener("click", () => {
    instructionEndTime = Date.now();
    postStartTime = Date.now();
    showScreen("posttestScreen");
  });

  // Post-quiz
  document.getElementById("postSubmit").addEventListener("click", () => {
    const errEl = document.getElementById("postError");
    errEl.textContent = "";
    const qNames = ["post_q1","post_q2","post_q3","post_q4","post_q5"];
    for (const q of qNames) {
      const v = getSelectedValue(q);
      if (!v) {
        errEl.textContent = "Please answer all questions before submitting.";
        return;
      }
      postAnswers[q] = v;
    }
    postEndTime = Date.now();
    submitAllData();
  });

  function submitAllData() {
    const submitStatus = document.getElementById("submitStatus");
    submitStatus.textContent = "";
    submitStatus.classList.remove("correct","incorrect");

    const preScore = computePreScore();
    const postScore = computePostScore();
    const gain = postScore - preScore;

    const preDur = preEndTime && preStartTime ? (preEndTime - preStartTime) / 1000 : "";
    const instDur = instructionEndTime && instructionStartTime ? (instructionEndTime - instructionStartTime) / 1000 : "";
    const postDur = postEndTime && postStartTime ? (postEndTime - postStartTime) / 1000 : "";

    const payload = {
      timestamp_client: new Date().toISOString(),
      condition: condition || "",
      pre_mcq_score: preScore,
      post_mcq_score: postScore,
      gain_mcq_score: gain,
      pre_duration_sec: preDur,
      instruction_duration_sec: instDur,
      post_duration_sec: postDur,
      table_view_count: tableViewCount
    };

    fetch(SCRIPT_URL, {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    }).then(() => {
      submitStatus.textContent = "Responses submitted.";
      submitStatus.classList.add("correct");
      showScreen("finalScreen");
    }).catch(err => {
      console.error(err);
      submitStatus.textContent = "There was an error submitting your responses. Please screenshot this page.";
      submitStatus.classList.add("incorrect");
    });
  }
</script>
</body>
</html>
